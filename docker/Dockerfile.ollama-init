# docker/Dockerfile.ollama-init
FROM ollama/ollama:0.3.14
SHELL ["/bin/sh","-lc"]

# Job one-shot: espera o daemon, só faz pull se faltar, e termina.
ENTRYPOINT ["sh","-lc","\
  echo '[init] aguardando ollama daemon...'; \
  until ollama ps >/dev/null 2>&1; do sleep 1; done; \
  for m in nomic-embed-text 'mistral:latest'; do \
    if ollama show \"$m\" >/dev/null 2>&1; then \
      echo \"[init] modelo já presente: $m\"; \
    else \
      echo \"[init] puxando modelo: $m\"; \
      ollama pull \"$m\"; \
    fi; \
  done; \
  echo '[init] modelos prontos. Saindo.' \
"]
