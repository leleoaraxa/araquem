id: client_fiis_positions
result_key: positions
sql_view: client_fiis_positions
private: true
description: >
  Posições do cliente em FIIs (PRIVADA; exige parâmetro document_number obtido de contexto seguro,
  nunca do texto livre do usuário).

identifiers:
  - name: document_number
    description: Documento do cliente (CPF/CNPJ) – fornecido via payload seguro (nunca pelo texto do usuário).
  - name: position_date
    description: Data da posição (data de referência do retrato da carteira).
  - name: ticker
    description: Ticker do FII (AAAA11).

default_date_field: position_date

columns:
  - name: document_number
    alias: Documento
    description: CPF/CNPJ do cliente (PII).
  - name: position_date
    alias: Data da posição
    description: Data de referência da posição em FIIs.
  - name: ticker
    alias: Código FII
    description: Código do fundo na B3 (AAAA11).
  - name: fii_name
    alias: Nome do FII
    description: Nome do fundo imobiliário.
  - name: participant_name
    alias: Participante
    description: Corretora/participante responsável pela custódia.
  - name: qty
    alias: Quantidade
    description: Quantidade em custódia na data da posição.
  - name: closing_price
    alias: Preço fechamento
    description: Preço de fechamento do dia para o FII.
  - name: update_value
    alias: Variação (R$)
    description: Variação de valor da posição em reais no período de referência.
  - name: available_quantity
    alias: Quantidade disp.
    description: Quantidade de cotas disponíveis (não bloqueadas).
  - name: average_price
    alias: Preço médio
    description: Preço médio da posição em FIIs.
  - name: profitability_percentage
    alias: Rentabilidade (%)
    description: Rentabilidade da posição em percentual.
  - name: percentage
    alias: Peso na carteira (%)
    description: Percentual da posição em relação à carteira total de FIIs.
  - name: created_at
    alias: Criado em
    description: Data de criação do registro.
  - name: updated_at
    alias: Atualizado em
    description: Data da última atualização do registro.

presentation:
  kind: table
  fields:
    key: ticker
    value: qty
  empty_message: Sem posições disponíveis.

ask:
  intents:
    - client_fiis_positions

  # Observação: PII no texto do usuário deve ser ignorado (compliance LGPD).
  keywords:
    - minhas posicoes
    - posicao
    - quantidade
    - qtd
    - custodia
    - disponivel
    - rentabilidade
    - rentabilidade da posicao
    - ganho
    - ganho percentual
    - ganho em
    - lucro
    - lucro em
    - peso na carteira
    - percentual na carteira
    - porcentagem na carteira
    - participacao
    - corretora
    - participante
    - custodiado

  phrase_includes:
    - "minhas posicoes"
    - "minha carteira de fiis"
    - "minha carteira de fundos imobiliarios"
    - "minhas posicoes em fiis"
    - "minhas posicoes em fundos imobiliarios"
    - "quantidade de fiis na minha custodia"
    - "quantidade em custodia"
    - "peso do fii na minha carteira"
    - "peso desse fii na minha carteira"
    - "peso desse fundo na minha carteira"
    - "rentabilidade da minha posicao em"
    - "rentabilidade da posicao em"
    - "qual a corretora do"
    - "em qual corretora esta o"
    - "onde estao minhas cotas do"
    - "onde o"
    - "em qual corretora esta esse fundo"
    - "qual e o fii com maior peso na minha carteira"
    - "qual e o fii mais rentavel da minha carteira"
    - "quais fiis da minha carteira estao dando lucro"
    - "distribuicao da minha carteira de fiis"

  synonyms:
    ticker:
      - ativo
      - papel
      - fundo
      - fii
    qty:
      - quantidade
      - qtde
      - qtd
      - numero de cotas
      - cotas
    closing_price:
      - preco
      - preco de fechamento
      - cotacao
      - cotacao de fechamento
    average_price:
      - preco medio
      - pm
      - preco medio de compra
      - preco medio da posicao
    profitability_percentage:
      - rentabilidade
      - rentabilidade da posicao
      - ganho percentual
      - ganho em
      - lucro em
      - retorno em
      - retorno percentual
      - resultado em
    percentage:
      - peso
      - peso na carteira
      - percentual na carteira
      - porcentagem na carteira
      - participacao na carteira

  weights:
    identifiers: 2.0
    keywords: 1.0
    synonyms: 0.5


params:
  required: [document_number]

order_by_whitelist:
  - position_date desc
  - ticker asc

aggregations:
  enabled: false

responses:
  default:
    kind: table
    template: responses/table.md.j2
