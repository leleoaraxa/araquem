services:
  quality-cron:
    image: quality-runner
    container_name: araquem-quality-cron
    restart: unless-stopped
    environment:
      - API_URL=http://araquem-api:8000
      - QUALITY_OPS_TOKEN=${QUALITY_OPS_TOKEN:-araquem-secret-bust-2025}
      - QUALITY_SAMPLES_GLOB=data/ops/quality/*.json
      - QUALITY_PUSH_SLEEP=0.2
    command: >
      bash -lc "
        while true; do
          python ./scripts/quality_push_cron.py &&
          ./scripts/quality_gate_check.sh || true;
          sleep 3600;
        done
      "
    working_dir: /workspace
    volumes:
      - ./:/workspace:ro
    depends_on:
      - api
    networks:
      - araquem_network

networks:
  araquem_network:
    external: true
