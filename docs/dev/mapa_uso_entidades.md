# Mapa de uso de templates e hints

## Mapa de uso por entidade
| entidade | has_templates_md | has_responses_templates | has_hints_md | usados_por |
|---|---|---|---|---|
| client_fiis_positions | true【F:data/entities/client_fiis_positions/templates.md†L1-L5】 | [responses/table.md.j2]【F:data/entities/client_fiis_positions/responses/table.md.j2†L1-L5】 | false | `responder.render_answer`, `formatter.render_rows_template`, `presenter.present`【F:app/responder/__init__.py†L16-L155】【F:app/formatter/rows.py†L102-L147】【F:app/presenter/presenter.py†L195-L285】 |
| fiis_cadastro | true【F:data/entities/fiis_cadastro/templates.md†L1-L5】 | [responses/list.md.j2]【F:data/entities/fiis_cadastro/responses/list.md.j2†L1-L5】 | false | `responder.render_answer`, `formatter.render_rows_template`, `presenter.present`【F:app/responder/__init__.py†L16-L155】【F:app/formatter/rows.py†L102-L147】【F:app/presenter/presenter.py†L195-L285】 |
| fiis_dividendos | true【F:data/entities/fiis_dividendos/templates.md†L1-L5】 | [responses/table.md.j2]【F:data/entities/fiis_dividendos/responses/table.md.j2†L1-L5】 | false | `responder.render_answer`, `formatter.render_rows_template`, `presenter.present`【F:app/responder/__init__.py†L16-L155】【F:app/formatter/rows.py†L102-L147】【F:app/presenter/presenter.py†L195-L285】 |
| fiis_financials_revenue_schedule | true【F:data/entities/fiis_financials_revenue_schedule/templates.md†L1-L5】 | [responses/table.md.j2]【F:data/entities/fiis_financials_revenue_schedule/responses/table.md.j2†L1-L5】 | true【F:data/entities/fiis_financials_revenue_schedule/hints.md†L1-L5】 | `responder.render_answer`, `formatter.render_rows_template`, `presenter.present`, RAG (`entity_hints_from_rag` + embeddings index)【F:app/responder/__init__.py†L16-L155】【F:app/formatter/rows.py†L102-L147】【F:app/presenter/presenter.py†L195-L285】【F:app/planner/planner.py†L212-L315】【F:data/embeddings/index.yaml†L81-L96】 |
| fiis_financials_risk | true【F:data/entities/fiis_financials_risk/templates.md†L1-L5】 | [responses/summary.md.j2]【F:data/entities/fiis_financials_risk/responses/summary.md.j2†L1-L5】 | true【F:data/entities/fiis_financials_risk/hints.md†L1-L5】 | `responder.render_answer`, `formatter.render_rows_template`, `presenter.present`, RAG (`entity_hints_from_rag` + embeddings index)【F:app/responder/__init__.py†L16-L155】【F:app/formatter/rows.py†L102-L147】【F:app/presenter/presenter.py†L195-L285】【F:app/planner/planner.py†L212-L315】【F:data/embeddings/index.yaml†L85-L95】 |
| fiis_financials_snapshot | true【F:data/entities/fiis_financials_snapshot/templates.md†L1-L5】 | [responses/summary.md.j2]【F:data/entities/fiis_financials_snapshot/responses/summary.md.j2†L1-L5】 | false | `responder.render_answer`, `formatter.render_rows_template`, `presenter.present`【F:app/responder/__init__.py†L16-L155】【F:app/formatter/rows.py†L102-L147】【F:app/presenter/presenter.py†L195-L285】 |
| fiis_imoveis | true【F:data/entities/fiis_imoveis/templates.md†L1-L5】 | [responses/list.md.j2]【F:data/entities/fiis_imoveis/responses/list.md.j2†L1-L5】 | false | `responder.render_answer`, `formatter.render_rows_template`, `presenter.present`【F:app/responder/__init__.py†L16-L155】【F:app/formatter/rows.py†L102-L147】【F:app/presenter/presenter.py†L195-L285】 |
| fiis_noticias | true【F:data/entities/fiis_noticias/templates.md†L1-L5】 | [responses/list.md.j2]【F:data/entities/fiis_noticias/responses/list.md.j2†L1-L5】 | false | `responder.render_answer`, `formatter.render_rows_template`, `presenter.present`【F:app/responder/__init__.py†L16-L155】【F:app/formatter/rows.py†L102-L147】【F:app/presenter/presenter.py†L195-L285】 |
| fiis_precos | true【F:data/entities/fiis_precos/templates.md†L1-L5】 | [responses/table.md.j2]【F:data/entities/fiis_precos/responses/table.md.j2†L1-L5】 | false | `responder.render_answer`, `formatter.render_rows_template`, `presenter.present`【F:app/responder/__init__.py†L16-L155】【F:app/formatter/rows.py†L102-L147】【F:app/presenter/presenter.py†L195-L285】 |
| fiis_processos | true【F:data/entities/fiis_processos/templates.md†L1-L5】 | [responses/list.md.j2]【F:data/entities/fiis_processos/responses/list.md.j2†L1-L5】 | false | `responder.render_answer`, `formatter.render_rows_template`, `presenter.present`【F:app/responder/__init__.py†L16-L155】【F:app/formatter/rows.py†L102-L147】【F:app/presenter/presenter.py†L195-L285】 |
| fiis_rankings | true【F:data/entities/fiis_rankings/templates.md†L1-L5】 | [responses/table.md.j2]【F:data/entities/fiis_rankings/responses/table.md.j2†L1-L5】 | false | `responder.render_answer`, `formatter.render_rows_template`, `presenter.present`【F:app/responder/__init__.py†L16-L155】【F:app/formatter/rows.py†L102-L147】【F:app/presenter/presenter.py†L195-L285】 |
| history_b3_indexes | true【F:data/entities/history_b3_indexes/templates.md†L1-L5】 | [responses/list.md.j2]【F:data/entities/history_b3_indexes/responses/list.md.j2†L1-L5】 | false | `responder.render_answer`, `formatter.render_rows_template`, `presenter.present`【F:app/responder/__init__.py†L16-L155】【F:app/formatter/rows.py†L102-L147】【F:app/presenter/presenter.py†L195-L285】 |
| history_currency_rates | true【F:data/entities/history_currency_rates/templates.md†L1-L5】 | [responses/list.md.j2]【F:data/entities/history_currency_rates/responses/list.md.j2†L1-L5】 | false | `responder.render_answer`, `formatter.render_rows_template`, `presenter.present`【F:app/responder/__init__.py†L16-L155】【F:app/formatter/rows.py†L102-L147】【F:app/presenter/presenter.py†L195-L285】 |
| history_market_indicators | true【F:data/entities/history_market_indicators/templates.md†L1-L5】 | [responses/list.md.j2]【F:data/entities/history_market_indicators/responses/list.md.j2†L1-L5】 | false | `responder.render_answer`, `formatter.render_rows_template`, `presenter.present`【F:app/responder/__init__.py†L16-L155】【F:app/formatter/rows.py†L102-L147】【F:app/presenter/presenter.py†L195-L285】 |

## Uso de templates.md em runtime
- `templates.md` é carregado por `_load_templates` e usado por `render_answer` para compor respostas determinísticas a partir de métricas, listas ou fallbacks.【F:app/responder/__init__.py†L16-L154】  
- `presenter.present` chama `render_answer`, garantindo leitura de `templates.md` em produção para o baseline textual devolvido ao cliente.【F:app/presenter/presenter.py†L195-L285】  
- Não há outro consumidor direto; a leitura é exclusivamente para formatação de saída (camada Formatter/Presenter).

## Uso de hints.md
- `data/entities/fiis_financials_risk/hints.md` e `data/entities/fiis_financials_revenue_schedule/hints.md` estão incluídos no índice RAG (`data/embeddings/index.yaml`) com IDs `entity-fiis-financials-risk-hints` e `entity-fiis-financials-revenue-hints`.【F:data/embeddings/index.yaml†L85-L96】  
- Os resultados do índice são consumidos pelo Planner via `entity_hints_from_rag`, produzindo sinal de hints por entidade para fusão de score de roteamento.【F:app/planner/planner.py†L212-L315】  
- Conclusão: os `hints.md` servem apenas como contexto de RAG/embeddings; não há uso em camadas de apresentação ou formatação.

## Possíveis duplicidades de fonte de verdade
- Nenhuma entidade possui `sample_questions` nos respectivos `<entity>.yaml`; apenas blocos `ask` (intents/keywords/synonyms) coexistem com templates de resposta, sem exemplos de perguntas em `templates.md`, logo não há duplicidade entre exemplos de pergunta e templates.【F:data/entities/fiis_cadastro/fiis_cadastro.yaml†L85-L115】
