entity: client_fiis_positions
name: client_fiis_positions
description: Posições diárias de FIIs por cliente com métricas de preço e rentabilidade.
kind: view
version: 1

columns:
  - { name: document_number,        type: string,   nullable: false, desc: "documento do cliente (CPF/CNPJ)" }
  - { name: position_date,          type: date,     nullable: false, desc: "data da posição" }
  - { name: ticker,                 type: string,   nullable: false, desc: "código do FII (AAAA11)" }
  - { name: fii_name,               type: string,   nullable: true,  desc: "nome do fundo" }
  - { name: participant_name,       type: string,   nullable: true,  desc: "corretora/participante" }
  - { name: qty,                    type: integer,  nullable: true,  desc: "quantidade em custódia" }
  - { name: closing_price,          type: number,   nullable: true,  desc: "preço de fechamento do dia" }
  - { name: update_value,           type: number,   nullable: true,  desc: "variação de valor" }
  - { name: available_quantity,     type: integer,  nullable: true,  desc: "quantidade disponível" }
  - { name: average_price,          type: number,   nullable: true,  desc: "preço médio da posição" }
  - { name: profitability_percentage, type: number, nullable: true,  desc: "rentabilidade da posição em percentual" }
  - { name: percentage,             type: number,   nullable: true,  desc: "percentual da posição na carteira" }
  - { name: created_at,             type: timestamp, nullable: false, desc: "data de criação do registro" }
  - { name: updated_at,             type: timestamp, nullable: false, desc: "data da última atualização do registro" }

ordering: [document_number, position_date, ticker]

presentation:
  # Importante (LGPD): não expor document_number em nenhuma visualização padrão.
  columns:
    ticker:                   { as: string }     # código AAAA11
    position_date:            { as: date }       # "25/10/2025"
    fii_name:                 { as: string }     # nome do fundo
    participant_name:         { as: string }     # corretora/participante
    qty:                      { as: integer }    # quantidade em custódia
    closing_price:            { as: currency }   # "R$ 123,45"
    update_value:             { as: currency }   # "R$ 12,34"
    available_quantity:       { as: integer }    # quantidade disponível
    average_price:            { as: currency }   # preço médio
    profitability_percentage: { as: percent, multiply_by_100: false, precision: 2 } # "10,50%"
    percentage:               { as: percent, multiply_by_100: false, precision: 2 } # "7,25%"

  rules: {}

sample_questions:
  - "quais são minhas posições em FIIs?"
  - "qual a minha carteira de FIIs?"
  - "quantidade de FIIs na minha custódia"
  - "minhas posições em fundos imobiliários"
  - "minha carteira de fundos imobiliários"
  - "quantidade de fundos imobiliários na minha custódia"
  - "qual é o preço médio do HGLG11?"
  - "qual a rentabilidade do MXRF11 na minha carteira?"
  - "qual o peso do XPML11 na minha carteira?"
  - "em qual corretora está o HGLG11?"
  - "qual é o FII com maior peso na minha carteira?"
  - "qual é o FII mais rentável da minha carteira?"

tolerance:
  extra_columns_allowed: false
  missing_columns_allowed: false
  nullable_mismatch_warn_only: false
