# ğŸ“ˆ **Fase M11 â€” Observability Enhancements**

> **PerÃ­odo estimado:** 2025-11-11 â†’ 2025-11-15
> **Estado inicial:** sistema estÃ¡vel e documentado (M10.2 concluÃ­da)
> **Objetivo central:** elevar a observabilidade a nÃ­vel â€œSLO-gradeâ€, garantindo rastreabilidade, mÃ©tricas contratuais e confiabilidade preditiva no ciclo `/ask`.

---

## ğŸ¯ **Objetivos principais**

| NÂº     | Objetivo                                    | DescriÃ§Ã£o                                                                                                                                                      |
| ------ | ------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **O1** | ğŸ” Auditoria automÃ¡tica de schemas crÃ­ticos | Validar se o schema SQL de `explain_events` e entidades de mÃ©tricas estÃ¡ sincronizado com o cÃ³digo (`app/analytics/explain.py`, `executor/pg.py`).             |
| **O2** | ğŸ“Š Dashboards e alertas versionados         | Garantir que todos os dashboards Grafana (`grafana/dashboards/*.json`) e regras Prometheus (`prometheus/alerting_rules.yml`) estejam versionadas e auditÃ¡veis. |
| **O3** | âš™ï¸ Pipeline de mÃ©tricas unificado           | Consolidar mÃ©tricas de planner, cache, executor e rag em um catÃ¡logo Prometheus documentado em `docs/dev/observability/overview.md`.                           |
| **O4** | ğŸ§  Explain Observability Loop               | Conectar `explain_events` â†’ `app/analytics/metrics.py` â†’ Grafana, com vistas Explain reais (decisÃµes do planner, gaps, latÃªncia mÃ©dia, cache hit-ratio).       |
| **O5** | ğŸ› ï¸ CI Observability Gate                   | Adicionar job de verificaÃ§Ã£o (`scripts/observability/obs_audit.py`) para validar schemas, dashboards e mÃ©tricas antes do merge.                                |

---

## ğŸ“¦ **Escopo**

| Tipo                    | DescriÃ§Ã£o                                                                                                          |
| ----------------------- | ------------------------------------------------------------------------------------------------------------------ |
| **Infra**               | Auditor de schemas (`scripts/observability/hash_guard.py` + `tests/observability/test_alerting_rules.py`)          |
| **Dashboards**          | 00_sirios_overview.json, 10_api_slo_pipeline.json, 20_planner_rag_intelligence.json, 30_ops_reliability.json       |
| **MÃ©tricas Prometheus** | Planner, Cache, Executor, Narrator, RAG, Analytics                                                                 |
| **DocumentaÃ§Ã£o**        | AtualizaÃ§Ã£o de `docs/dev/observability/overview.md` e inclusÃ£o de seÃ§Ã£o â€œContracts CI Observabilityâ€ no Guardrails |
| **Qualidade**           | MÃ©trica â€œobservability_contracts_passâ€ adicionada ao relatÃ³rio `/ops/quality/report`                               |

---

## ğŸ§© **Deliverables (entregas)**

| Entrega | DescriÃ§Ã£o                              | Artefatos                                                                                     |
| ------- | -------------------------------------- | --------------------------------------------------------------------------------------------- |
| **D1**  | Auditoria de schema `explain_events`   | `scripts/observability/obs_audit.py`, `tests/explain/test_explain_schema_sync.py`             |
| **D2**  | Painel Explain Intelligence atualizado | `grafana/dashboards/20_planner_rag_intelligence.json.j2`                                      |
| **D3**  | Dashboard Ops Reliability v2           | `grafana/dashboards/30_ops_reliability.json.j2`                                               |
| **D4**  | MÃ©tricas de latÃªncia e cache agregadas | `app/observability/metrics.py` e documentaÃ§Ã£o em `docs/dev/observability/overview.md`         |
| **D5**  | Job de CI observability-gate           | Pipeline script (`scripts/quality/quality_gate_check.sh`) ampliado para mÃ©tricas e dashboards |

---

## âœ… **Definition of Done (DoD â€“ M11)**

* [ ] Todos os dashboards e regras Prometheus validados e versionados com hash no repositÃ³rio.
* [ ] `explain_events` validado contra schema SQL na CI (testes passam).
* [ ] CatÃ¡logo de mÃ©tricas atualizado em `docs/dev/observability/overview.md`.
* [ ] MÃ©trica `observability_contracts_pass` aparece no `/ops/quality/report`.
* [ ] Dashboards *20_planner_rag_intelligence* e *30_ops_reliability* renderizam sem erro no Grafana local.
* [ ] Commit final `docs: finalize M11 observability enhancements (schema sync + dashboards v2)`.

---

## ğŸ§­ **Mindset M11**

> â€œVer Ã© entender.
> M11 nÃ£o cria cÃ³digo novo â€” ele transforma a execuÃ§Ã£o em visÃ£o.
> A observabilidade deixa de ser adorno e passa a ser contrato.â€

