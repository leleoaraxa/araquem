entity: fiis_metrics
kind: projection
version: 2

description: >-
  Contrato lógico das projeções compute-on-read (SELECT) expostas pelo módulo `fiis_metrics`.
  Define apenas o shape de saída parametrizável — não corresponde a view ou tabela persistida.

columns:
  - { name: ticker,             type: string,  nullable: false, desc: "código do FII AAAA11" }
  - { name: metric,             type: string,  nullable: false, desc: "nome canônico" }
  - { name: value,              type: number,  nullable: true,  desc: "valor da métrica" }
  - { name: window_months,      type: integer, nullable: true,  desc: "janela (meses)" }
  - { name: period_start,       type: date,    nullable: true,  desc: "data inicial" }
  - { name: period_end,         type: date,    nullable: true,  desc: "data final" }

ordering: [ticker, metric, window_months DESC, period_end DESC]

presentation:
  columns:
    ticker:         { as: string }    # código AAAA11
    metric:         { as: string }    # dividends_sum
    value:          { as: number }    # 10,90 || 0,2567
    period_start:   { as: date }      # 31/01/2025
    period_end:     { as: date }      # 31/06/2025
    window_months:  { as: integer }   # 6

  rules: {}

sample_questions:
  - "soma de dividendos do HGLG11"
  - "quanto de dividendos o HGLG11 pagou nos últimos 12 meses?"
  - "preço médio do HGLG11 nos últimos 6 meses"
  - "dy médio do HGLG11 no ano"
  - "média de preço do KNRI11"
  - "qual o dividend yield médio do HGRU11"
  - "dividend yield médio do HGRU11 nos últimos 12 meses"
  - "dividend yield médio do HGRU11 no ano"
  - "dividend yield médio do HGRU11 nos últimos 6 meses"
  - "preço médio do HGRU11 nos últimos 12 meses"
  - "preço médio do HGRU11 no ano"
  - "preço médio do HGRU11 nos últimos 6 meses"

tolerance:
  extra_columns_allowed: false
  missing_columns_allowed: false
  nullable_mismatch_warn_only: true

projection_groups:
  risk:
    result_key: risk_metrics
    metrics:
      - risk.volatility_ratio
      - risk.sharpe_ratio
      - risk.sortino_ratio
      - risk.treynor_ratio
      - risk.jensen_alpha
      - risk.beta_index
      - risk.max_drawdown
      - risk.r_squared
  dividends:
    result_key: dividends_metrics
    metrics:
      - dividends.dividends_sum
      - dividends.dividends_count
      - dividends.dy_avg
  prices:
    result_key: prices_metrics
    metrics:
      - prices.price_avg
      - prices.return_period
