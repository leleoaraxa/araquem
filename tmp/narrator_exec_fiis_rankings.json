{
  "executor_payload": {
    "question": "qual a posição do HGLG11 no ranking sirios",
    "facts": {
      "result_key": "rankings_fii",
      "rows": [
        {
          "ticker": "HGLG11",
          "users_rank_position": 0.0,
          "users_rank_net_movement": 0.0,
          "sirios_rank_position": 0.0,
          "sirios_rank_net_movement": 0.0,
          "ifix_rank_position": 4.0,
          "ifix_rank_net_movement": 0.0,
          "ifil_rank_position": 4.0,
          "ifil_rank_net_movement": 0.0,
          "created_at": "2024-05-22 00:00:00",
          "updated_at": "2025-11-17 00:00:00"
        }
      ],
      "primary": {
        "ticker": "HGLG11",
        "users_rank_position": 0.0,
        "users_rank_net_movement": 0.0,
        "sirios_rank_position": 0.0,
        "sirios_rank_net_movement": 0.0,
        "ifix_rank_position": 4.0,
        "ifix_rank_net_movement": 0.0,
        "ifil_rank_position": 4.0,
        "ifil_rank_net_movement": 0.0,
        "created_at": "2024-05-22 00:00:00",
        "updated_at": "2025-11-17 00:00:00"
      },
      "aggregates": {
        "agg": null,
        "window": null,
        "order": "desc"
      },
      "identifiers": {},
      "ticker": null,
      "fund": null
    },
    "meta": {
      "intent": "fiis_rankings",
      "entity": "fiis_rankings",
      "explain": {
        "signals": {
          "token_scores": [
            {
              "token": "posicao",
              "weight": 1.1,
              "hits": 1,
              "intent": "client_fiis_positions"
            },
            {
              "token": "ranking",
              "weight": -1.1,
              "hits": 1,
              "intent": "fiis_cadastro"
            },
            {
              "token": "ranking",
              "weight": -1.1,
              "hits": 1,
              "intent": "fiis_precos"
            },
            {
              "token": "ranking",
              "weight": -1.1,
              "hits": 1,
              "intent": "fiis_imoveis"
            },
            {
              "token": "ranking",
              "weight": 1.1,
              "hits": 1,
              "intent": "fiis_rankings"
            },
            {
              "token": "posicao",
              "weight": 1.1,
              "hits": 1,
              "intent": "fiis_rankings"
            },
            {
              "token": "sirios",
              "weight": 1.1,
              "hits": 1,
              "intent": "fiis_rankings"
            }
          ],
          "phrase_scores": [
            {
              "phrase": "posicao do",
              "weight": 3.3,
              "hits": 1,
              "intent": "fiis_rankings"
            }
          ],
          "anti_hits": [],
          "normalizations": [
            {
              "step": "lower",
              "applied": true
            },
            {
              "step": "strip_accents",
              "applied": true
            },
            {
              "step": "strip_punct",
              "applied": true
            }
          ],
          "weights_summary": {
            "token_sum": 1.1,
            "phrase_sum": 3.3,
            "anti_sum": 0.0,
            "total": 4.4
          }
        },
        "decision_path": [
          {
            "stage": "tokenize",
            "type": "normalization",
            "value": "qual a posicao do hglg11 no ranking sirios",
            "result": [
              "qual",
              "a",
              "posicao",
              "do",
              "hglg11",
              "no",
              "ranking",
              "sirios"
            ]
          },
          {
            "stage": "fuse",
            "type": "rag_integration",
            "rag_weight": 0.15
          },
          {
            "stage": "fuse",
            "type": "rag_fusion",
            "weight": 0.15,
            "affected": 5
          },
          {
            "stage": "rank",
            "type": "intent_scoring",
            "intent": "fiis_rankings",
            "score": 5.711534665950815
          },
          {
            "stage": "route",
            "type": "entity_select",
            "entity": "fiis_rankings",
            "score_after": 5.711534665950815
          },
          {
            "stage": "rag",
            "type": "entity_hints",
            "k": 5,
            "min_score": 0.25,
            "weight": 0.35,
            "hints_keys": [
              "fiis_rankings"
            ]
          }
        ],
        "scoring": {
          "intent": [
            {
              "name": "fiis_rankings",
              "score": 5.711534665950815,
              "winner": true
            }
          ],
          "entity": [
            {
              "name": "fiis_rankings",
              "score": 5.711534665950815,
              "winner": true
            }
          ],
          "intent_top2_gap_base": 5.5,
          "intent_top2_gap_final": 4.776534665950814,
          "final_combined": [
            {
              "intent": "fiis_rankings",
              "score": 5.711534665950815
            },
            {
              "intent": "client_fiis_positions",
              "score": 0.935
            },
            {
              "intent": "fiis_dividendos",
              "score": 0.0
            },
            {
              "intent": "fiis_financials_snapshot",
              "score": 0.0
            },
            {
              "intent": "fiis_financials_revenue_schedule",
              "score": 0.0
            },
            {
              "intent": "fiis_financials_risk",
              "score": 0.0
            },
            {
              "intent": "fiis_noticias",
              "score": 0.0
            },
            {
              "intent": "fiis_processos",
              "score": 0.0
            },
            {
              "intent": "history_b3_indexes",
              "score": 0.0
            },
            {
              "intent": "history_currency_rates",
              "score": 0.0
            },
            {
              "intent": "history_market_indicators",
              "score": 0.0
            },
            {
              "intent": "fiis_cadastro",
              "score": -0.935
            },
            {
              "intent": "fiis_precos",
              "score": -0.935
            },
            {
              "intent": "fiis_imoveis",
              "score": -0.935
            }
          ],
          "rag_hint": [
            {
              "entity": "fiis_rankings",
              "score": 0.6768977730054381
            }
          ],
          "rag_signal": [
            {
              "intent": "client_fiis_positions",
              "entity": "client_fiis_positions",
              "score": 0.0
            },
            {
              "intent": "fiis_cadastro",
              "entity": "fiis_cadastro",
              "score": 0.0
            },
            {
              "intent": "fiis_precos",
              "entity": "fiis_precos",
              "score": 0.0
            },
            {
              "intent": "fiis_dividendos",
              "entity": "fiis_dividendos",
              "score": 0.0
            },
            {
              "intent": "fiis_financials_snapshot",
              "entity": "fiis_financials_snapshot",
              "score": 0.0
            },
            {
              "intent": "fiis_financials_revenue_schedule",
              "entity": "fiis_financials_revenue_schedule",
              "score": 0.0
            },
            {
              "intent": "fiis_financials_risk",
              "entity": "fiis_financials_risk",
              "score": 0.0
            },
            {
              "intent": "fiis_imoveis",
              "entity": "fiis_imoveis",
              "score": 0.0
            },
            {
              "intent": "fiis_noticias",
              "entity": "fiis_noticias",
              "score": 0.0
            },
            {
              "intent": "fiis_processos",
              "entity": "fiis_processos",
              "score": 0.0
            },
            {
              "intent": "fiis_rankings",
              "entity": "fiis_rankings",
              "score": 0.6768977730054381
            },
            {
              "intent": "history_b3_indexes",
              "entity": "history_b3_indexes",
              "score": 0.0
            },
            {
              "intent": "history_currency_rates",
              "entity": "history_currency_rates",
              "score": 0.0
            },
            {
              "intent": "history_market_indicators",
              "entity": "history_market_indicators",
              "score": 0.0
            }
          ],
          "combined": {
            "intent": [
              {
                "name": "fiis_rankings",
                "base": 6.6,
                "rag": 0.6768977730054381,
                "combined": 5.711534665950815,
                "winner": true
              },
              {
                "name": "client_fiis_positions",
                "base": 1.1,
                "rag": 0.0,
                "combined": 0.935,
                "winner": false
              },
              {
                "name": "fiis_dividendos",
                "base": 0.0,
                "rag": 0.0,
                "combined": 0.0,
                "winner": false
              },
              {
                "name": "fiis_financials_snapshot",
                "base": 0.0,
                "rag": 0.0,
                "combined": 0.0,
                "winner": false
              },
              {
                "name": "fiis_financials_revenue_schedule",
                "base": 0.0,
                "rag": 0.0,
                "combined": 0.0,
                "winner": false
              },
              {
                "name": "fiis_financials_risk",
                "base": 0.0,
                "rag": 0.0,
                "combined": 0.0,
                "winner": false
              },
              {
                "name": "fiis_noticias",
                "base": 0.0,
                "rag": 0.0,
                "combined": 0.0,
                "winner": false
              },
              {
                "name": "fiis_processos",
                "base": 0.0,
                "rag": 0.0,
                "combined": 0.0,
                "winner": false
              },
              {
                "name": "history_b3_indexes",
                "base": 0.0,
                "rag": 0.0,
                "combined": 0.0,
                "winner": false
              },
              {
                "name": "history_currency_rates",
                "base": 0.0,
                "rag": 0.0,
                "combined": 0.0,
                "winner": false
              },
              {
                "name": "history_market_indicators",
                "base": 0.0,
                "rag": 0.0,
                "combined": 0.0,
                "winner": false
              },
              {
                "name": "fiis_cadastro",
                "base": -1.1,
                "rag": 0.0,
                "combined": -0.935,
                "winner": false
              },
              {
                "name": "fiis_precos",
                "base": -1.1,
                "rag": 0.0,
                "combined": -0.935,
                "winner": false
              },
              {
                "name": "fiis_imoveis",
                "base": -1.1,
                "rag": 0.0,
                "combined": -0.935,
                "winner": false
              }
            ],
            "entity": [
              {
                "name": "fiis_rankings",
                "base": 6.6,
                "rag": 0.6768977730054381,
                "combined": 5.711534665950815,
                "winner": true
              },
              {
                "name": "client_fiis_positions",
                "base": 1.1,
                "rag": 0.0,
                "combined": 0.935,
                "winner": false
              },
              {
                "name": "fiis_dividendos",
                "base": 0.0,
                "rag": 0.0,
                "combined": 0.0,
                "winner": false
              },
              {
                "name": "fiis_financials_snapshot",
                "base": 0.0,
                "rag": 0.0,
                "combined": 0.0,
                "winner": false
              },
              {
                "name": "fiis_financials_revenue_schedule",
                "base": 0.0,
                "rag": 0.0,
                "combined": 0.0,
                "winner": false
              },
              {
                "name": "fiis_financials_risk",
                "base": 0.0,
                "rag": 0.0,
                "combined": 0.0,
                "winner": false
              },
              {
                "name": "fiis_noticias",
                "base": 0.0,
                "rag": 0.0,
                "combined": 0.0,
                "winner": false
              },
              {
                "name": "fiis_processos",
                "base": 0.0,
                "rag": 0.0,
                "combined": 0.0,
                "winner": false
              },
              {
                "name": "history_b3_indexes",
                "base": 0.0,
                "rag": 0.0,
                "combined": 0.0,
                "winner": false
              },
              {
                "name": "history_currency_rates",
                "base": 0.0,
                "rag": 0.0,
                "combined": 0.0,
                "winner": false
              },
              {
                "name": "history_market_indicators",
                "base": 0.0,
                "rag": 0.0,
                "combined": 0.0,
                "winner": false
              },
              {
                "name": "fiis_cadastro",
                "base": -1.1,
                "rag": 0.0,
                "combined": -0.935,
                "winner": false
              },
              {
                "name": "fiis_precos",
                "base": -1.1,
                "rag": 0.0,
                "combined": -0.935,
                "winner": false
              },
              {
                "name": "fiis_imoveis",
                "base": -1.1,
                "rag": 0.0,
                "combined": -0.935,
                "winner": false
              }
            ],
            "weight": 0.15,
            "notes": "blend=base*(1-w)+rag*w"
          },
          "thresholds_applied": {
            "min_score": 1.0,
            "min_gap": 0.2,
            "gap": 4.776534665950814,
            "accepted": true,
            "source": "final"
          }
        },
        "rag": {
          "enabled": true,
          "index_path": "data/embeddings/store/embeddings.jsonl",
          "k": 5,
          "min_score": 0.25,
          "weight": 0.35,
          "entity_hints": {
            "fiis_rankings": 0.6768977730054381
          },
          "error": null,
          "used": true,
          "re_rank": {
            "enabled": true,
            "mode": "blend",
            "weight": 0.15
          }
        },
        "rag_context": {
          "top_doc": "golden-m65-quality-yaml",
          "snippets": [
            "{ question: \"rendimento do HGLG11\", expected_intent: dividendos, expected_entity: fiis_dividendos }\n - { question: \"ranking do HGLG11\", expected_intent: rankings, expected_entity: fiis_rankings }\n - { question: \"posicao do HGLG11 no IFIX\",…",
            "stion\": \"qual a posição do FPAB11 no IFIL\",\n \"expected_intent\": \"fiis_rankings\",\n \"expected_entity\": \"fiis_rankings\"\n },\n {\n \"question\": \"qual a posição do FPAB11 no IFIX\",\n \"expected_intent\": \"fiis_rankings\",\n \"expected_entity\":…",
            "usuarios movimento\n - variacao usuarios\n - movimentos usuarios\n sirios_rank_position:\n - sirios ranking\n - ranking da sirios\n - vezes sirios\n sirios_rank_net_movement:\n - sirios movimento\n - variacao sirios\n - movimentos sirios…"
          ],
          "reason": "Contexto cita tokens do intent vencedor: ranking, posicao, movimentos para entity fiis_rankings."
        },
        "fusion": {
          "enabled": true,
          "used": true,
          "weight": 0.15,
          "mode": "blend",
          "affected_entities": [
            "fiis_rankings",
            "client_fiis_positions",
            "fiis_cadastro",
            "fiis_precos",
            "fiis_imoveis"
          ],
          "error": null
        }
      }
    }
  }
}
