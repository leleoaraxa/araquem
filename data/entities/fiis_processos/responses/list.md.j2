{% set rows = rows if rows is defined else [] %}

{% if results is defined and meta is defined and meta.result_key is defined %}
  {% if meta.result_key in results %}
    {% set rows = results[meta.result_key] %}
  {% endif %}
{% endif %}

{% if rows and rows|length > 0 %}
{% set tickers = rows | map(attribute='ticker') | unique | list %}

{% if tickers|length == 1 %}
**Processos do {{ tickers[0] }} ({{ rows|length }})**
{% else %}
**Processos encontrados ({{ rows|length }})**
{% endif %}

{% for ticker in tickers %}
{% if tickers|length > 1 %}
### {{ ticker }}
{% endif %}

{% for r in rows if r.ticker == ticker %}
- **{{ r.process_number or "-" }}**{% if r.judgment %} — {{ r.judgment }}{% endif %}
  - Instância: {{ r.instance or "-" }}
  - Início: {{ r.initiation_date | date_br if r.initiation_date else "-" }}
  - Valor da causa: {{ r.cause_amt | currency_br if r.cause_amt is not none else "-" }}
  - Risco de perda: {{ r.loss_risk_pct | percent_br if r.loss_risk_pct is not none else "-" }}
  - Partes: {{ r.process_parts or "-" }}
  - Fatos principais: {{ r.main_facts or "-" }}
  - Análise de impacto: {{ r.loss_impact_analysis or "-" }}
  - Atualizado em: {{ r.updated_at | date_br if r.updated_at else "-" }}
{% endfor %}
{% endfor %}
{% else %}
{{ empty_message or "Nenhum registro encontrado." }}
{% endif %}
