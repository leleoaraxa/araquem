id: client_fiis_positions
result_key: positions
sql_view: client_fiis_positions
private: true
description: Posições do cliente em FIIs (PRIVADA; exige parâmetro document_number).

identifiers:
  - name: document_number
    description: Documento do cliente (CPF/CNPJ) – fornecido via payload seguro (nunca pelo texto do usuário)
  - name: position_date
    description: Data da posição
  - name: ticker
    description: Ticker do FII (AAAA11)

default_date_field: position_date

columns:
- name: document_number
  alias: Documento
  description: CPF/CNPJ do cliente (PII).
- name: position_date
  alias: Data da posição
  description: Data de referência.
- name: ticker
  alias: Código FII
  description: Código do fundo na B3 (AAAA11).
- name: fii_name
  alias: Nome do FII
  description: Nome do fundo.
- name: participant_name
  alias: Participante
  description: Corretora/participante.
- name: qty
  alias: Quantidade
  description: Quantidade em custódia.
- name: closing_price
  alias: Preço fechamento
  description: Preço de fechamento do dia.
- name: update_value
  alias: Variação (R$)
  description: Variação de valor.
- name: available_quantity
  alias: Quantidade disp.
  description: Quantidade disponível.
- name: average_price
  alias: Preço médio
  description: Preço médio da posição.
- name: profitability_percentage
  alias: Rentabilidade (%)
  description: Rentabilidade da posição em percentual.
- name: percentage
  alias: Peso na carteira (%)
  description: Percentual da posição em relação à carteira total.
- name: created_at
  alias: Criado em
  description: Data de criação do registro.
- name: updated_at
  alias: Atualizado em
  description: Data da última atualização do registro.

presentation:
  kind: table
  fields:
    key: ticker
    value: qty
  empty_message: Sem posições disponíveis.

ask:
  intents:
    - client_fiis_positions

  # Observação: PII no texto do usuário deve ser ignorado (compliance LGPD).
  keywords:
    - minhas posicoes
    - minha carteira
    - posicao
    - minhas posiçoes
    - minhas posições
    - carteira
    - carteira de fii
    - carteira de fiis
    - carteira de fundos imobiliarios
    - carteira de fundos imobiliários
    - quantidade
    - qtd
    - custodia
    - custódia
    - preco medio
    - preço medio
    - preço médio
    - rentabilidade
    - rentabilidade da posicao
    - rentabilidade da posição
    - ganho
    - ganho percentual
    - ganho em %
    - lucro
    - lucro em %
    - peso na carteira
    - percentual na carteira
    - porcentagem na carteira
    - participacao
    - participação

  phrase_includes:
    - "minhas posicoes"
    - "minhas posições"
    - "minha carteira de fiis"
    - "minha carteira de fundos imobiliarios"
    - "preco medio do"
    - "preço medio do"
    - "preço médio do"
    - "rentabilidade do"
    - "rentabilidade da posicao do"
    - "rentabilidade da posição do"
    - "peso do"
    - "percentual do"
    - "porcentagem do"
    - "participacao do"
    - "participação do"

  synonyms:
    ticker:
      - ativo
      - papel
      - fundo
      - fii
    qty:
      - quantidade
      - qtde
      - qtd
      - numero de cotas
      - número de cotas
      - cotas
    closing_price:
      - preco
      - preço
      - preco de fechamento
      - preço de fechamento
      - cotacao
      - cotação
      - cotacao de fechamento
      - cotação de fechamento
    average_price:
      - preco medio
      - preço medio
      - preço médio
      - pm
      - preço médio de compra
      - preco medio de compra
      - preco medio da posicao
      - preço médio da posição
    profitability_percentage:
      - rentabilidade
      - rentabilidade da posicao
      - rentabilidade da posição
      - ganho percentual
      - ganho em
      - lucro em
      - retorno em
      - retorno percentual
      - resultado em
    percentage:
      - peso
      - peso na carteira
      - percentual na carteira
      - porcentagem na carteira
      - participacao na carteira
      - participação na carteira

  weights:
    identifiers: 2.0
    keywords: 1.0
    synonyms: 0.5

params:
  required: [document_number]


order_by_whitelist:
  - position_date desc
  - ticker asc

aggregations:
  enabled: false
