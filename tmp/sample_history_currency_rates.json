{
    "status": {
        "reason": "ok",
        "message": "ok"
    },
    "results": {
        "history_currency_rates": [
            {
                "rate_date": "2025-11-17 00:00:00",
                "usd_buy_amt": "R$ 5,30",
                "usd_sell_amt": "R$ 5,30",
                "usd_var_pct": "0,00%",
                "eur_buy_amt": "R$ 6,15",
                "eur_sell_amt": "R$ 6,16",
                "eur_var_pct": "-1,00%",
                "created_at": "2025-11-16 00:00:00",
                "updated_at": "2025-11-16 00:00:00"
            },
            {
                "rate_date": "2025-11-14 00:00:00",
                "usd_buy_amt": "R$ 5,30",
                "usd_sell_amt": "R$ 5,30",
                "usd_var_pct": "0,00%",
                "eur_buy_amt": "R$ 6,15",
                "eur_sell_amt": "R$ 6,16",
                "eur_var_pct": "-1,00%",
                "created_at": "2025-11-15 00:00:00",
                "updated_at": "2025-11-15 00:00:00"
            },
            {
                "rate_date": "2025-11-13 00:00:00",
                "usd_buy_amt": "R$ 5,30",
                "usd_sell_amt": "R$ 5,30",
                "usd_var_pct": "4,00%",
                "eur_buy_amt": "R$ 6,16",
                "eur_sell_amt": "R$ 6,17",
                "eur_var_pct": "8,00%",
                "created_at": "2025-11-14 00:00:00",
                "updated_at": "2025-11-14 00:00:00"
            },
            {
                "rate_date": "2025-11-12 00:00:00",
                "usd_buy_amt": "R$ 5,29",
                "usd_sell_amt": "R$ 5,29",
                "usd_var_pct": "2,00%",
                "eur_buy_amt": "R$ 6,14",
                "eur_sell_amt": "R$ 6,14",
                "eur_var_pct": "3,00%",
                "created_at": "2025-11-13 00:00:00",
                "updated_at": "2025-11-13 00:00:00"
            },
            {
                "rate_date": "2025-11-11 00:00:00",
                "usd_buy_amt": "R$ 5,27",
                "usd_sell_amt": "R$ 5,27",
                "usd_var_pct": "2,00%",
                "eur_buy_amt": "R$ 6,11",
                "eur_sell_amt": "R$ 6,11",
                "eur_var_pct": "-2,00%",
                "created_at": "2025-11-12 00:00:00",
                "updated_at": "2025-11-12 00:00:00"
            },
            {
                "rate_date": "2025-11-10 00:00:00",
                "usd_buy_amt": "R$ 5,33",
                "usd_sell_amt": "R$ 5,33",
                "usd_var_pct": "0,00%",
                "eur_buy_amt": "R$ 6,17",
                "eur_sell_amt": "R$ 6,17",
                "eur_var_pct": "12,00%",
                "created_at": "2025-11-09 00:00:00",
                "updated_at": "2025-11-09 00:00:00"
            },
            {
                "rate_date": "2025-11-07 00:00:00",
                "usd_buy_amt": "R$ 5,33",
                "usd_sell_amt": "R$ 5,33",
                "usd_var_pct": "0,00%",
                "eur_buy_amt": "R$ 6,17",
                "eur_sell_amt": "R$ 6,17",
                "eur_var_pct": "12,00%",
                "created_at": "2025-11-08 00:00:00",
                "updated_at": "2025-11-08 00:00:00"
            },
            {
                "rate_date": "2025-11-06 00:00:00",
                "usd_buy_amt": "R$ 5,35",
                "usd_sell_amt": "R$ 5,35",
                "usd_var_pct": "5,00%",
                "eur_buy_amt": "R$ 6,18",
                "eur_sell_amt": "R$ 6,18",
                "eur_var_pct": "6,00%",
                "created_at": "2025-11-07 00:00:00",
                "updated_at": "2025-11-07 00:00:00"
            },
            {
                "rate_date": "2025-11-05 00:00:00",
                "usd_buy_amt": "R$ 5,36",
                "usd_sell_amt": "R$ 5,36",
                "usd_var_pct": "9,00%",
                "eur_buy_amt": "R$ 6,16",
                "eur_sell_amt": "R$ 6,16",
                "eur_var_pct": "9,00%",
                "created_at": "2025-11-06 00:00:00",
                "updated_at": "2025-11-06 00:00:00"
            },
            {
                "rate_date": "2025-11-04 00:00:00",
                "usd_buy_amt": "R$ 5,40",
                "usd_sell_amt": "R$ 5,40",
                "usd_var_pct": "-4,00%",
                "eur_buy_amt": "R$ 6,20",
                "eur_sell_amt": "R$ 6,20",
                "eur_var_pct": "-2,00%",
                "created_at": "2025-11-05 00:00:00",
                "updated_at": "2025-11-05 00:00:00"
            }
        ]
    },
    "meta": {
        "planner": {
            "normalized": "cotacao do euro comercial",
            "tokens": [
                "cotacao",
                "do",
                "euro",
                "comercial"
            ],
            "intent_scores": {
                "client_fiis_positions": 0.0,
                "fiis_cadastro": -4.4,
                "fiis_precos": 1.0999999999999996,
                "fiis_dividendos": 0.0,
                "fiis_financials_snapshot": 0.0,
                "fiis_financials_revenue_schedule": 0.0,
                "fiis_financials_risk": 0.0,
                "fiis_imoveis": 0.0,
                "fiis_noticias": 0.0,
                "fiis_processos": 1.1,
                "fiis_rankings": 0.0,
                "history_b3_indexes": -2.2,
                "history_currency_rates": 9.9,
                "history_market_indicators": -2.2
            },
            "details": {
                "client_fiis_positions": {
                    "token_includes": [],
                    "token_excludes": [],
                    "phrase_includes": [],
                    "phrase_excludes": [],
                    "anti_penalty": 0.0,
                    "entities": [
                        "client_fiis_positions"
                    ]
                },
                "fiis_cadastro": {
                    "token_includes": [],
                    "token_excludes": [
                        "cotacao"
                    ],
                    "phrase_includes": [],
                    "phrase_excludes": [
                        "cotacao do"
                    ],
                    "anti_penalty": 0.0,
                    "entities": [
                        "fiis_cadastro"
                    ]
                },
                "fiis_precos": {
                    "token_includes": [
                        "cotacao"
                    ],
                    "token_excludes": [
                        "eur",
                        "euro",
                        "comercial"
                    ],
                    "phrase_includes": [
                        "cotacao do"
                    ],
                    "phrase_excludes": [],
                    "anti_penalty": 0.0,
                    "entities": [
                        "fiis_precos"
                    ]
                },
                "fiis_dividendos": {
                    "token_includes": [],
                    "token_excludes": [],
                    "phrase_includes": [],
                    "phrase_excludes": [],
                    "anti_penalty": 0.0,
                    "entities": [
                        "fiis_dividendos"
                    ]
                },
                "fiis_financials_snapshot": {
                    "token_includes": [],
                    "token_excludes": [],
                    "phrase_includes": [],
                    "phrase_excludes": [],
                    "anti_penalty": 0.0,
                    "entities": [
                        "fiis_financials_snapshot"
                    ]
                },
                "fiis_financials_revenue_schedule": {
                    "token_includes": [],
                    "token_excludes": [],
                    "phrase_includes": [],
                    "phrase_excludes": [],
                    "anti_penalty": 0.0,
                    "entities": [
                        "fiis_financials_revenue_schedule"
                    ]
                },
                "fiis_financials_risk": {
                    "token_includes": [],
                    "token_excludes": [],
                    "phrase_includes": [],
                    "phrase_excludes": [],
                    "anti_penalty": 0.0,
                    "entities": [
                        "fiis_financials_risk"
                    ]
                },
                "fiis_imoveis": {
                    "token_includes": [],
                    "token_excludes": [],
                    "phrase_includes": [],
                    "phrase_excludes": [],
                    "anti_penalty": 0.0,
                    "entities": [
                        "fiis_imoveis"
                    ]
                },
                "fiis_noticias": {
                    "token_includes": [],
                    "token_excludes": [],
                    "phrase_includes": [],
                    "phrase_excludes": [],
                    "anti_penalty": 0.0,
                    "entities": [
                        "fiis_noticias"
                    ]
                },
                "fiis_processos": {
                    "token_includes": [
                        "acao"
                    ],
                    "token_excludes": [],
                    "phrase_includes": [],
                    "phrase_excludes": [],
                    "anti_penalty": 0.0,
                    "entities": [
                        "fiis_processos"
                    ]
                },
                "fiis_rankings": {
                    "token_includes": [],
                    "token_excludes": [],
                    "phrase_includes": [],
                    "phrase_excludes": [],
                    "anti_penalty": 0.0,
                    "entities": [
                        "fiis_rankings"
                    ]
                },
                "history_b3_indexes": {
                    "token_includes": [],
                    "token_excludes": [
                        "eur",
                        "euro"
                    ],
                    "phrase_includes": [],
                    "phrase_excludes": [],
                    "anti_penalty": 0.0,
                    "entities": [
                        "history_b3_indexes"
                    ]
                },
                "history_currency_rates": {
                    "token_includes": [
                        "euro",
                        "eur",
                        "cotacao"
                    ],
                    "token_excludes": [],
                    "phrase_includes": [
                        "cotacao do euro",
                        "euro comercial"
                    ],
                    "phrase_excludes": [],
                    "anti_penalty": 0.0,
                    "entities": [
                        "history_currency_rates"
                    ]
                },
                "history_market_indicators": {
                    "token_includes": [],
                    "token_excludes": [
                        "eur",
                        "euro"
                    ],
                    "phrase_includes": [],
                    "phrase_excludes": [],
                    "anti_penalty": 0.0,
                    "entities": [
                        "history_market_indicators"
                    ]
                }
            },
            "chosen": {
                "intent": "history_currency_rates",
                "entity": "history_currency_rates",
                "score": 8.415000000000001,
                "accepted": true
            },
            "explain": {
                "signals": {
                    "token_scores": [
                        {
                            "token": "cotacao",
                            "weight": -1.1,
                            "hits": 1,
                            "intent": "fiis_cadastro"
                        },
                        {
                            "token": "cotacao",
                            "weight": 1.1,
                            "hits": 1,
                            "intent": "fiis_precos"
                        },
                        {
                            "token": "eur",
                            "weight": -1.1,
                            "hits": 1,
                            "intent": "fiis_precos"
                        },
                        {
                            "token": "euro",
                            "weight": -1.1,
                            "hits": 1,
                            "intent": "fiis_precos"
                        },
                        {
                            "token": "comercial",
                            "weight": -1.1,
                            "hits": 1,
                            "intent": "fiis_precos"
                        },
                        {
                            "token": "acao",
                            "weight": 1.1,
                            "hits": 1,
                            "intent": "fiis_processos"
                        },
                        {
                            "token": "eur",
                            "weight": -1.1,
                            "hits": 1,
                            "intent": "history_b3_indexes"
                        },
                        {
                            "token": "euro",
                            "weight": -1.1,
                            "hits": 1,
                            "intent": "history_b3_indexes"
                        },
                        {
                            "token": "euro",
                            "weight": 1.1,
                            "hits": 1,
                            "intent": "history_currency_rates"
                        },
                        {
                            "token": "eur",
                            "weight": 1.1,
                            "hits": 1,
                            "intent": "history_currency_rates"
                        },
                        {
                            "token": "cotacao",
                            "weight": 1.1,
                            "hits": 1,
                            "intent": "history_currency_rates"
                        },
                        {
                            "token": "eur",
                            "weight": -1.1,
                            "hits": 1,
                            "intent": "history_market_indicators"
                        },
                        {
                            "token": "euro",
                            "weight": -1.1,
                            "hits": 1,
                            "intent": "history_market_indicators"
                        }
                    ],
                    "phrase_scores": [
                        {
                            "phrase": "cotacao do",
                            "weight": -3.3,
                            "hits": 1,
                            "intent": "fiis_cadastro"
                        },
                        {
                            "phrase": "cotacao do",
                            "weight": 3.3,
                            "hits": 1,
                            "intent": "fiis_precos"
                        },
                        {
                            "phrase": "cotacao do euro",
                            "weight": 3.3,
                            "hits": 1,
                            "intent": "history_currency_rates"
                        },
                        {
                            "phrase": "euro comercial",
                            "weight": 3.3,
                            "hits": 1,
                            "intent": "history_currency_rates"
                        }
                    ],
                    "anti_hits": [],
                    "normalizations": [
                        {
                            "step": "lower",
                            "applied": true
                        },
                        {
                            "step": "strip_accents",
                            "applied": true
                        },
                        {
                            "step": "strip_punct",
                            "applied": true
                        }
                    ],
                    "weights_summary": {
                        "token_sum": -3.3000000000000003,
                        "phrase_sum": 6.6,
                        "anti_sum": 0.0,
                        "total": 3.2999999999999994
                    }
                },
                "decision_path": [
                    {
                        "stage": "tokenize",
                        "type": "normalization",
                        "value": "cotacao do euro comercial",
                        "result": [
                            "cotacao",
                            "do",
                            "euro",
                            "comercial"
                        ]
                    },
                    {
                        "stage": "fuse",
                        "type": "rag_integration",
                        "rag_weight": 0.15
                    },
                    {
                        "stage": "fuse",
                        "type": "rag_fusion",
                        "weight": 0.15,
                        "affected": 7
                    },
                    {
                        "stage": "rank",
                        "type": "intent_scoring",
                        "intent": "history_currency_rates",
                        "score": 8.415000000000001
                    },
                    {
                        "stage": "route",
                        "type": "entity_select",
                        "entity": "history_currency_rates",
                        "score_after": 8.415000000000001
                    },
                    {
                        "stage": "rag",
                        "type": "entity_hints",
                        "k": 5,
                        "min_score": 0.25,
                        "weight": 0.35,
                        "hints_keys": [
                            "fiis_financials_revenue_schedule"
                        ]
                    }
                ],
                "scoring": {
                    "intent": [
                        {
                            "name": "history_currency_rates",
                            "score": 8.415000000000001,
                            "winner": true
                        }
                    ],
                    "entity": [
                        {
                            "name": "history_currency_rates",
                            "score": 8.415000000000001,
                            "winner": true
                        }
                    ],
                    "intent_top2_gap_base": 8.8,
                    "intent_top2_gap_final": 7.48,
                    "final_combined": [
                        {
                            "intent": "history_currency_rates",
                            "score": 8.415000000000001
                        },
                        {
                            "intent": "fiis_processos",
                            "score": 0.935
                        },
                        {
                            "intent": "fiis_precos",
                            "score": 0.9349999999999997
                        },
                        {
                            "intent": "fiis_financials_revenue_schedule",
                            "score": 0.09948830621807653
                        },
                        {
                            "intent": "client_fiis_positions",
                            "score": 0.0
                        },
                        {
                            "intent": "fiis_dividendos",
                            "score": 0.0
                        },
                        {
                            "intent": "fiis_financials_snapshot",
                            "score": 0.0
                        },
                        {
                            "intent": "fiis_financials_risk",
                            "score": 0.0
                        },
                        {
                            "intent": "fiis_imoveis",
                            "score": 0.0
                        },
                        {
                            "intent": "fiis_noticias",
                            "score": 0.0
                        },
                        {
                            "intent": "fiis_rankings",
                            "score": 0.0
                        },
                        {
                            "intent": "history_b3_indexes",
                            "score": -1.87
                        },
                        {
                            "intent": "history_market_indicators",
                            "score": -1.87
                        },
                        {
                            "intent": "fiis_cadastro",
                            "score": -3.74
                        }
                    ],
                    "rag_hint": [
                        {
                            "entity": "fiis_financials_revenue_schedule",
                            "score": 0.6632553747871769
                        }
                    ],
                    "rag_signal": [
                        {
                            "intent": "client_fiis_positions",
                            "entity": "client_fiis_positions",
                            "score": 0.0
                        },
                        {
                            "intent": "fiis_cadastro",
                            "entity": "fiis_cadastro",
                            "score": 0.0
                        },
                        {
                            "intent": "fiis_precos",
                            "entity": "fiis_precos",
                            "score": 0.0
                        },
                        {
                            "intent": "fiis_dividendos",
                            "entity": "fiis_dividendos",
                            "score": 0.0
                        },
                        {
                            "intent": "fiis_financials_snapshot",
                            "entity": "fiis_financials_snapshot",
                            "score": 0.0
                        },
                        {
                            "intent": "fiis_financials_revenue_schedule",
                            "entity": "fiis_financials_revenue_schedule",
                            "score": 0.6632553747871769
                        },
                        {
                            "intent": "fiis_financials_risk",
                            "entity": "fiis_financials_risk",
                            "score": 0.0
                        },
                        {
                            "intent": "fiis_imoveis",
                            "entity": "fiis_imoveis",
                            "score": 0.0
                        },
                        {
                            "intent": "fiis_noticias",
                            "entity": "fiis_noticias",
                            "score": 0.0
                        },
                        {
                            "intent": "fiis_processos",
                            "entity": "fiis_processos",
                            "score": 0.0
                        },
                        {
                            "intent": "fiis_rankings",
                            "entity": "fiis_rankings",
                            "score": 0.0
                        },
                        {
                            "intent": "history_b3_indexes",
                            "entity": "history_b3_indexes",
                            "score": 0.0
                        },
                        {
                            "intent": "history_currency_rates",
                            "entity": "history_currency_rates",
                            "score": 0.0
                        },
                        {
                            "intent": "history_market_indicators",
                            "entity": "history_market_indicators",
                            "score": 0.0
                        }
                    ],
                    "combined": {
                        "intent": [
                            {
                                "name": "history_currency_rates",
                                "base": 9.9,
                                "rag": 0.0,
                                "combined": 8.415000000000001,
                                "winner": true
                            },
                            {
                                "name": "fiis_processos",
                                "base": 1.1,
                                "rag": 0.0,
                                "combined": 0.935,
                                "winner": false
                            },
                            {
                                "name": "fiis_precos",
                                "base": 1.0999999999999996,
                                "rag": 0.0,
                                "combined": 0.9349999999999997,
                                "winner": false
                            },
                            {
                                "name": "fiis_financials_revenue_schedule",
                                "base": 0.0,
                                "rag": 0.6632553747871769,
                                "combined": 0.09948830621807653,
                                "winner": false
                            },
                            {
                                "name": "client_fiis_positions",
                                "base": 0.0,
                                "rag": 0.0,
                                "combined": 0.0,
                                "winner": false
                            },
                            {
                                "name": "fiis_dividendos",
                                "base": 0.0,
                                "rag": 0.0,
                                "combined": 0.0,
                                "winner": false
                            },
                            {
                                "name": "fiis_financials_snapshot",
                                "base": 0.0,
                                "rag": 0.0,
                                "combined": 0.0,
                                "winner": false
                            },
                            {
                                "name": "fiis_financials_risk",
                                "base": 0.0,
                                "rag": 0.0,
                                "combined": 0.0,
                                "winner": false
                            },
                            {
                                "name": "fiis_imoveis",
                                "base": 0.0,
                                "rag": 0.0,
                                "combined": 0.0,
                                "winner": false
                            },
                            {
                                "name": "fiis_noticias",
                                "base": 0.0,
                                "rag": 0.0,
                                "combined": 0.0,
                                "winner": false
                            },
                            {
                                "name": "fiis_rankings",
                                "base": 0.0,
                                "rag": 0.0,
                                "combined": 0.0,
                                "winner": false
                            },
                            {
                                "name": "history_b3_indexes",
                                "base": -2.2,
                                "rag": 0.0,
                                "combined": -1.87,
                                "winner": false
                            },
                            {
                                "name": "history_market_indicators",
                                "base": -2.2,
                                "rag": 0.0,
                                "combined": -1.87,
                                "winner": false
                            },
                            {
                                "name": "fiis_cadastro",
                                "base": -4.4,
                                "rag": 0.0,
                                "combined": -3.74,
                                "winner": false
                            }
                        ],
                        "entity": [
                            {
                                "name": "history_currency_rates",
                                "base": 9.9,
                                "rag": 0.0,
                                "combined": 8.415000000000001,
                                "winner": true
                            },
                            {
                                "name": "fiis_processos",
                                "base": 1.1,
                                "rag": 0.0,
                                "combined": 0.935,
                                "winner": false
                            },
                            {
                                "name": "fiis_precos",
                                "base": 1.0999999999999996,
                                "rag": 0.0,
                                "combined": 0.9349999999999997,
                                "winner": false
                            },
                            {
                                "name": "fiis_financials_revenue_schedule",
                                "base": 0.0,
                                "rag": 0.6632553747871769,
                                "combined": 0.09948830621807653,
                                "winner": false
                            },
                            {
                                "name": "client_fiis_positions",
                                "base": 0.0,
                                "rag": 0.0,
                                "combined": 0.0,
                                "winner": false
                            },
                            {
                                "name": "fiis_dividendos",
                                "base": 0.0,
                                "rag": 0.0,
                                "combined": 0.0,
                                "winner": false
                            },
                            {
                                "name": "fiis_financials_snapshot",
                                "base": 0.0,
                                "rag": 0.0,
                                "combined": 0.0,
                                "winner": false
                            },
                            {
                                "name": "fiis_financials_risk",
                                "base": 0.0,
                                "rag": 0.0,
                                "combined": 0.0,
                                "winner": false
                            },
                            {
                                "name": "fiis_imoveis",
                                "base": 0.0,
                                "rag": 0.0,
                                "combined": 0.0,
                                "winner": false
                            },
                            {
                                "name": "fiis_noticias",
                                "base": 0.0,
                                "rag": 0.0,
                                "combined": 0.0,
                                "winner": false
                            },
                            {
                                "name": "fiis_rankings",
                                "base": 0.0,
                                "rag": 0.0,
                                "combined": 0.0,
                                "winner": false
                            },
                            {
                                "name": "history_b3_indexes",
                                "base": -2.2,
                                "rag": 0.0,
                                "combined": -1.87,
                                "winner": false
                            },
                            {
                                "name": "history_market_indicators",
                                "base": -2.2,
                                "rag": 0.0,
                                "combined": -1.87,
                                "winner": false
                            },
                            {
                                "name": "fiis_cadastro",
                                "base": -4.4,
                                "rag": 0.0,
                                "combined": -3.74,
                                "winner": false
                            }
                        ],
                        "weight": 0.15,
                        "notes": "blend=base*(1-w)+rag*w"
                    },
                    "thresholds_applied": {
                        "min_score": 1.0,
                        "min_gap": 0.5,
                        "gap": 7.48,
                        "accepted": true,
                        "source": "final"
                    }
                },
                "rag": {
                    "enabled": true,
                    "index_path": "data/embeddings/store/embeddings.jsonl",
                    "k": 5,
                    "min_score": 0.25,
                    "weight": 0.35,
                    "entity_hints": {
                        "fiis_financials_revenue_schedule": 0.6632553747871769
                    },
                    "error": null,
                    "used": true,
                    "re_rank": {
                        "enabled": true,
                        "mode": "blend",
                        "weight": 0.15
                    }
                },
                "rag_context": {
                    "top_doc": "q-routing-samples",
                    "snippets": [
                        "ntity\": \"history_currency_rates\"\n },\n {\n \"question\": \"dólar comercial de ontem\",\n \"expected_intent\": \"history_currency_rates\",\n \"expected_entity\": \"history_currency_rates\"\n },\n {\n \"question\": \"euro hoje (D-1)\",\n \"expected_intent\":…",
                        "\"expected_entity\": \"history_currency_rates\"\n },\n {\n \"question\": \"cotação do euro comercial (D-1)\",\n \"expected_intent\": \"history_currency_rates\",\n \"expected_entity\": \"history_currency_rates\"\n },\n {\n \"question\": \"ipca de outubro (D-1)\",…",
                        ".\nO investidor compra cotas e torna-se participante proporcional ao número de cotas que possui.\n\nO funcionamento segue etapas básicas:\n\n1. O investidor aplica recursos comprando cotas do fundo.\n2. O gestor investe esses recursos em ativos…"
                    ],
                    "reason": "Contexto cita tokens do intent vencedor: dólar, usd, euro para entity history_currency_rates."
                },
                "fusion": {
                    "enabled": true,
                    "used": true,
                    "weight": 0.15,
                    "mode": "blend",
                    "affected_entities": [
                        "history_currency_rates",
                        "fiis_processos",
                        "fiis_precos",
                        "fiis_financials_revenue_schedule",
                        "history_b3_indexes",
                        "history_market_indicators",
                        "fiis_cadastro"
                    ],
                    "error": null
                }
            }
        },
        "result_key": "history_currency_rates",
        "planner_intent": "history_currency_rates",
        "planner_entity": "history_currency_rates",
        "planner_score": 8.415000000000001,
        "rows_total": 10,
        "elapsed_ms": 353,
        "explain": {
            "signals": {
                "token_scores": [
                    {
                        "token": "cotacao",
                        "weight": -1.1,
                        "hits": 1,
                        "intent": "fiis_cadastro"
                    },
                    {
                        "token": "cotacao",
                        "weight": 1.1,
                        "hits": 1,
                        "intent": "fiis_precos"
                    },
                    {
                        "token": "eur",
                        "weight": -1.1,
                        "hits": 1,
                        "intent": "fiis_precos"
                    },
                    {
                        "token": "euro",
                        "weight": -1.1,
                        "hits": 1,
                        "intent": "fiis_precos"
                    },
                    {
                        "token": "comercial",
                        "weight": -1.1,
                        "hits": 1,
                        "intent": "fiis_precos"
                    },
                    {
                        "token": "acao",
                        "weight": 1.1,
                        "hits": 1,
                        "intent": "fiis_processos"
                    },
                    {
                        "token": "eur",
                        "weight": -1.1,
                        "hits": 1,
                        "intent": "history_b3_indexes"
                    },
                    {
                        "token": "euro",
                        "weight": -1.1,
                        "hits": 1,
                        "intent": "history_b3_indexes"
                    },
                    {
                        "token": "euro",
                        "weight": 1.1,
                        "hits": 1,
                        "intent": "history_currency_rates"
                    },
                    {
                        "token": "eur",
                        "weight": 1.1,
                        "hits": 1,
                        "intent": "history_currency_rates"
                    },
                    {
                        "token": "cotacao",
                        "weight": 1.1,
                        "hits": 1,
                        "intent": "history_currency_rates"
                    },
                    {
                        "token": "eur",
                        "weight": -1.1,
                        "hits": 1,
                        "intent": "history_market_indicators"
                    },
                    {
                        "token": "euro",
                        "weight": -1.1,
                        "hits": 1,
                        "intent": "history_market_indicators"
                    }
                ],
                "phrase_scores": [
                    {
                        "phrase": "cotacao do",
                        "weight": -3.3,
                        "hits": 1,
                        "intent": "fiis_cadastro"
                    },
                    {
                        "phrase": "cotacao do",
                        "weight": 3.3,
                        "hits": 1,
                        "intent": "fiis_precos"
                    },
                    {
                        "phrase": "cotacao do euro",
                        "weight": 3.3,
                        "hits": 1,
                        "intent": "history_currency_rates"
                    },
                    {
                        "phrase": "euro comercial",
                        "weight": 3.3,
                        "hits": 1,
                        "intent": "history_currency_rates"
                    }
                ],
                "anti_hits": [],
                "normalizations": [
                    {
                        "step": "lower",
                        "applied": true
                    },
                    {
                        "step": "strip_accents",
                        "applied": true
                    },
                    {
                        "step": "strip_punct",
                        "applied": true
                    }
                ],
                "weights_summary": {
                    "token_sum": -3.3000000000000003,
                    "phrase_sum": 6.6,
                    "anti_sum": 0.0,
                    "total": 3.2999999999999994
                }
            },
            "decision_path": [
                {
                    "stage": "tokenize",
                    "type": "normalization",
                    "value": "cotacao do euro comercial",
                    "result": [
                        "cotacao",
                        "do",
                        "euro",
                        "comercial"
                    ]
                },
                {
                    "stage": "fuse",
                    "type": "rag_integration",
                    "rag_weight": 0.15
                },
                {
                    "stage": "fuse",
                    "type": "rag_fusion",
                    "weight": 0.15,
                    "affected": 7
                },
                {
                    "stage": "rank",
                    "type": "intent_scoring",
                    "intent": "history_currency_rates",
                    "score": 8.415000000000001
                },
                {
                    "stage": "route",
                    "type": "entity_select",
                    "entity": "history_currency_rates",
                    "score_after": 8.415000000000001
                },
                {
                    "stage": "rag",
                    "type": "entity_hints",
                    "k": 5,
                    "min_score": 0.25,
                    "weight": 0.35,
                    "hints_keys": [
                        "fiis_financials_revenue_schedule"
                    ]
                }
            ],
            "scoring": {
                "intent": [
                    {
                        "name": "history_currency_rates",
                        "score": 8.415000000000001,
                        "winner": true
                    }
                ],
                "entity": [
                    {
                        "name": "history_currency_rates",
                        "score": 8.415000000000001,
                        "winner": true
                    }
                ],
                "intent_top2_gap_base": 8.8,
                "intent_top2_gap_final": 7.48,
                "final_combined": [
                    {
                        "intent": "history_currency_rates",
                        "score": 8.415000000000001
                    },
                    {
                        "intent": "fiis_processos",
                        "score": 0.935
                    },
                    {
                        "intent": "fiis_precos",
                        "score": 0.9349999999999997
                    },
                    {
                        "intent": "fiis_financials_revenue_schedule",
                        "score": 0.09948830621807653
                    },
                    {
                        "intent": "client_fiis_positions",
                        "score": 0.0
                    },
                    {
                        "intent": "fiis_dividendos",
                        "score": 0.0
                    },
                    {
                        "intent": "fiis_financials_snapshot",
                        "score": 0.0
                    },
                    {
                        "intent": "fiis_financials_risk",
                        "score": 0.0
                    },
                    {
                        "intent": "fiis_imoveis",
                        "score": 0.0
                    },
                    {
                        "intent": "fiis_noticias",
                        "score": 0.0
                    },
                    {
                        "intent": "fiis_rankings",
                        "score": 0.0
                    },
                    {
                        "intent": "history_b3_indexes",
                        "score": -1.87
                    },
                    {
                        "intent": "history_market_indicators",
                        "score": -1.87
                    },
                    {
                        "intent": "fiis_cadastro",
                        "score": -3.74
                    }
                ],
                "rag_hint": [
                    {
                        "entity": "fiis_financials_revenue_schedule",
                        "score": 0.6632553747871769
                    }
                ],
                "rag_signal": [
                    {
                        "intent": "client_fiis_positions",
                        "entity": "client_fiis_positions",
                        "score": 0.0
                    },
                    {
                        "intent": "fiis_cadastro",
                        "entity": "fiis_cadastro",
                        "score": 0.0
                    },
                    {
                        "intent": "fiis_precos",
                        "entity": "fiis_precos",
                        "score": 0.0
                    },
                    {
                        "intent": "fiis_dividendos",
                        "entity": "fiis_dividendos",
                        "score": 0.0
                    },
                    {
                        "intent": "fiis_financials_snapshot",
                        "entity": "fiis_financials_snapshot",
                        "score": 0.0
                    },
                    {
                        "intent": "fiis_financials_revenue_schedule",
                        "entity": "fiis_financials_revenue_schedule",
                        "score": 0.6632553747871769
                    },
                    {
                        "intent": "fiis_financials_risk",
                        "entity": "fiis_financials_risk",
                        "score": 0.0
                    },
                    {
                        "intent": "fiis_imoveis",
                        "entity": "fiis_imoveis",
                        "score": 0.0
                    },
                    {
                        "intent": "fiis_noticias",
                        "entity": "fiis_noticias",
                        "score": 0.0
                    },
                    {
                        "intent": "fiis_processos",
                        "entity": "fiis_processos",
                        "score": 0.0
                    },
                    {
                        "intent": "fiis_rankings",
                        "entity": "fiis_rankings",
                        "score": 0.0
                    },
                    {
                        "intent": "history_b3_indexes",
                        "entity": "history_b3_indexes",
                        "score": 0.0
                    },
                    {
                        "intent": "history_currency_rates",
                        "entity": "history_currency_rates",
                        "score": 0.0
                    },
                    {
                        "intent": "history_market_indicators",
                        "entity": "history_market_indicators",
                        "score": 0.0
                    }
                ],
                "combined": {
                    "intent": [
                        {
                            "name": "history_currency_rates",
                            "base": 9.9,
                            "rag": 0.0,
                            "combined": 8.415000000000001,
                            "winner": true
                        },
                        {
                            "name": "fiis_processos",
                            "base": 1.1,
                            "rag": 0.0,
                            "combined": 0.935,
                            "winner": false
                        },
                        {
                            "name": "fiis_precos",
                            "base": 1.0999999999999996,
                            "rag": 0.0,
                            "combined": 0.9349999999999997,
                            "winner": false
                        },
                        {
                            "name": "fiis_financials_revenue_schedule",
                            "base": 0.0,
                            "rag": 0.6632553747871769,
                            "combined": 0.09948830621807653,
                            "winner": false
                        },
                        {
                            "name": "client_fiis_positions",
                            "base": 0.0,
                            "rag": 0.0,
                            "combined": 0.0,
                            "winner": false
                        },
                        {
                            "name": "fiis_dividendos",
                            "base": 0.0,
                            "rag": 0.0,
                            "combined": 0.0,
                            "winner": false
                        },
                        {
                            "name": "fiis_financials_snapshot",
                            "base": 0.0,
                            "rag": 0.0,
                            "combined": 0.0,
                            "winner": false
                        },
                        {
                            "name": "fiis_financials_risk",
                            "base": 0.0,
                            "rag": 0.0,
                            "combined": 0.0,
                            "winner": false
                        },
                        {
                            "name": "fiis_imoveis",
                            "base": 0.0,
                            "rag": 0.0,
                            "combined": 0.0,
                            "winner": false
                        },
                        {
                            "name": "fiis_noticias",
                            "base": 0.0,
                            "rag": 0.0,
                            "combined": 0.0,
                            "winner": false
                        },
                        {
                            "name": "fiis_rankings",
                            "base": 0.0,
                            "rag": 0.0,
                            "combined": 0.0,
                            "winner": false
                        },
                        {
                            "name": "history_b3_indexes",
                            "base": -2.2,
                            "rag": 0.0,
                            "combined": -1.87,
                            "winner": false
                        },
                        {
                            "name": "history_market_indicators",
                            "base": -2.2,
                            "rag": 0.0,
                            "combined": -1.87,
                            "winner": false
                        },
                        {
                            "name": "fiis_cadastro",
                            "base": -4.4,
                            "rag": 0.0,
                            "combined": -3.74,
                            "winner": false
                        }
                    ],
                    "entity": [
                        {
                            "name": "history_currency_rates",
                            "base": 9.9,
                            "rag": 0.0,
                            "combined": 8.415000000000001,
                            "winner": true
                        },
                        {
                            "name": "fiis_processos",
                            "base": 1.1,
                            "rag": 0.0,
                            "combined": 0.935,
                            "winner": false
                        },
                        {
                            "name": "fiis_precos",
                            "base": 1.0999999999999996,
                            "rag": 0.0,
                            "combined": 0.9349999999999997,
                            "winner": false
                        },
                        {
                            "name": "fiis_financials_revenue_schedule",
                            "base": 0.0,
                            "rag": 0.6632553747871769,
                            "combined": 0.09948830621807653,
                            "winner": false
                        },
                        {
                            "name": "client_fiis_positions",
                            "base": 0.0,
                            "rag": 0.0,
                            "combined": 0.0,
                            "winner": false
                        },
                        {
                            "name": "fiis_dividendos",
                            "base": 0.0,
                            "rag": 0.0,
                            "combined": 0.0,
                            "winner": false
                        },
                        {
                            "name": "fiis_financials_snapshot",
                            "base": 0.0,
                            "rag": 0.0,
                            "combined": 0.0,
                            "winner": false
                        },
                        {
                            "name": "fiis_financials_risk",
                            "base": 0.0,
                            "rag": 0.0,
                            "combined": 0.0,
                            "winner": false
                        },
                        {
                            "name": "fiis_imoveis",
                            "base": 0.0,
                            "rag": 0.0,
                            "combined": 0.0,
                            "winner": false
                        },
                        {
                            "name": "fiis_noticias",
                            "base": 0.0,
                            "rag": 0.0,
                            "combined": 0.0,
                            "winner": false
                        },
                        {
                            "name": "fiis_rankings",
                            "base": 0.0,
                            "rag": 0.0,
                            "combined": 0.0,
                            "winner": false
                        },
                        {
                            "name": "history_b3_indexes",
                            "base": -2.2,
                            "rag": 0.0,
                            "combined": -1.87,
                            "winner": false
                        },
                        {
                            "name": "history_market_indicators",
                            "base": -2.2,
                            "rag": 0.0,
                            "combined": -1.87,
                            "winner": false
                        },
                        {
                            "name": "fiis_cadastro",
                            "base": -4.4,
                            "rag": 0.0,
                            "combined": -3.74,
                            "winner": false
                        }
                    ],
                    "weight": 0.15,
                    "notes": "blend=base*(1-w)+rag*w"
                },
                "thresholds_applied": {
                    "min_score": 1.0,
                    "min_gap": 0.5,
                    "gap": 7.48,
                    "accepted": true,
                    "source": "final"
                }
            },
            "rag": {
                "enabled": true,
                "index_path": "data/embeddings/store/embeddings.jsonl",
                "k": 5,
                "min_score": 0.25,
                "weight": 0.35,
                "entity_hints": {
                    "fiis_financials_revenue_schedule": 0.6632553747871769
                },
                "error": null,
                "used": true,
                "re_rank": {
                    "enabled": true,
                    "mode": "blend",
                    "weight": 0.15
                }
            },
            "rag_context": {
                "top_doc": "q-routing-samples",
                "snippets": [
                    "ntity\": \"history_currency_rates\"\n },\n {\n \"question\": \"dólar comercial de ontem\",\n \"expected_intent\": \"history_currency_rates\",\n \"expected_entity\": \"history_currency_rates\"\n },\n {\n \"question\": \"euro hoje (D-1)\",\n \"expected_intent\":…",
                    "\"expected_entity\": \"history_currency_rates\"\n },\n {\n \"question\": \"cotação do euro comercial (D-1)\",\n \"expected_intent\": \"history_currency_rates\",\n \"expected_entity\": \"history_currency_rates\"\n },\n {\n \"question\": \"ipca de outubro (D-1)\",…",
                    ".\nO investidor compra cotas e torna-se participante proporcional ao número de cotas que possui.\n\nO funcionamento segue etapas básicas:\n\n1. O investidor aplica recursos comprando cotas do fundo.\n2. O gestor investe esses recursos em ativos…"
                ],
                "reason": "Contexto cita tokens do intent vencedor: dólar, usd, euro para entity history_currency_rates."
            },
            "fusion": {
                "enabled": true,
                "used": true,
                "weight": 0.15,
                "mode": "blend",
                "affected_entities": [
                    "history_currency_rates",
                    "fiis_processos",
                    "fiis_precos",
                    "fiis_financials_revenue_schedule",
                    "history_b3_indexes",
                    "history_market_indicators",
                    "fiis_cadastro"
                ],
                "error": null
            }
        },
        "explain_analytics": {
            "request_id": "7dc03751904841619104b4f4a2aeb452",
            "timestamp": "2025-11-17T10:43:18.895928+00:00",
            "summary": "Consulta 'history_currency_rates' em 'history_currency_rates' via view history_currency_rates (latência 353ms, cache miss).",
            "details": {
                "intent": "history_currency_rates",
                "entity": "history_currency_rates",
                "view": "history_currency_rates",
                "route_id": "history_currency_rates",
                "cache_hit": false,
                "latency_ms": 353.0,
                "route_source": "planner",
                "notes": null
            }
        },
        "cache": {
            "hit": false,
            "key": null,
            "ttl": null
        },
        "aggregates": {
            "agg": null,
            "window": null,
            "order": "desc"
        },
        "narrator": {
            "enabled": true,
            "shadow": true,
            "model": "sirios-narrator:latest",
            "latency_ms": 0.0,
            "error": null,
            "used": true,
            "score": 1.0,
            "strategy": "llm"
        }
    },
    "answer": "- **rate_date**: 2025-11-17 00:00:00; **usd_buy_amt**: R$ 5,30; **usd_sell_amt**: R$ 5,30; **usd_var_pct**: 0,00%; **eur_buy_amt**: R$ 6,15; **eur_sell_amt**: R$ 6,16; **eur_var_pct**: -1,00%; **created_at**: 2025-11-16 00:00:00; **updated_at**: 2025-11-16 00:00:00\n- **rate_date**: 2025-11-14 00:00:00; **usd_buy_amt**: R$ 5,30; **usd_sell_amt**: R$ 5,30; **usd_var_pct**: 0,00%; **eur_buy_amt**: R$ 6,15; **eur_sell_amt**: R$ 6,16; **eur_var_pct**: -1,00%; **created_at**: 2025-11-15 00:00:00; **updated_at**: 2025-11-15 00:00:00\n- **rate_date**: 2025-11-13 00:00:00; **usd_buy_amt**: R$ 5,30; **usd_sell_amt**: R$ 5,30; **usd_var_pct**: 4,00%; **eur_buy_amt**: R$ 6,16; **eur_sell_amt**: R$ 6,17; **eur_var_pct**: 8,00%; **created_at**: 2025-11-14 00:00:00; **updated_at**: 2025-11-14 00:00:00\n- **rate_date**: 2025-11-12 00:00:00; **usd_buy_amt**: R$ 5,29; **usd_sell_amt**: R$ 5,29; **usd_var_pct**: 2,00%; **eur_buy_amt**: R$ 6,14; **eur_sell_amt**: R$ 6,14; **eur_var_pct**: 3,00%; **created_at**: 2025-11-13 00:00:00; **updated_at**: 2025-11-13 00:00:00\n- **rate_date**: 2025-11-11 00:00:00; **usd_buy_amt**: R$ 5,27; **usd_sell_amt**: R$ 5,27; **usd_var_pct**: 2,00%; **eur_buy_amt**: R$ 6,11; **eur_sell_amt**: R$ 6,11; **eur_var_pct**: -2,00%; **created_at**: 2025-11-12 00:00:00; **updated_at**: 2025-11-12 00:00:00\n- **rate_date**: 2025-11-10 00:00:00; **usd_buy_amt**: R$ 5,33; **usd_sell_amt**: R$ 5,33; **usd_var_pct**: 0,00%; **eur_buy_amt**: R$ 6,17; **eur_sell_amt**: R$ 6,17; **eur_var_pct**: 12,00%; **created_at**: 2025-11-09 00:00:00; **updated_at**: 2025-11-09 00:00:00\n- **rate_date**: 2025-11-07 00:00:00; **usd_buy_amt**: R$ 5,33; **usd_sell_amt**: R$ 5,33; **usd_var_pct**: 0,00%; **eur_buy_amt**: R$ 6,17; **eur_sell_amt**: R$ 6,17; **eur_var_pct**: 12,00%; **created_at**: 2025-11-08 00:00:00; **updated_at**: 2025-11-08 00:00:00\n- **rate_date**: 2025-11-06 00:00:00; **usd_buy_amt**: R$ 5,35; **usd_sell_amt**: R$ 5,35; **usd_var_pct**: 5,00%; **eur_buy_amt**: R$ 6,18; **eur_sell_amt**: R$ 6,18; **eur_var_pct**: 6,00%; **created_at**: 2025-11-07 00:00:00; **updated_at**: 2025-11-07 00:00:00\n- **rate_date**: 2025-11-05 00:00:00; **usd_buy_amt**: R$ 5,36; **usd_sell_amt**: R$ 5,36; **usd_var_pct**: 9,00%; **eur_buy_amt**: R$ 6,16; **eur_sell_amt**: R$ 6,16; **eur_var_pct**: 9,00%; **created_at**: 2025-11-06 00:00:00; **updated_at**: 2025-11-06 00:00:00\n- **rate_date**: 2025-11-04 00:00:00; **usd_buy_amt**: R$ 5,40; **usd_sell_amt**: R$ 5,40; **usd_var_pct**: -4,00%; **eur_buy_amt**: R$ 6,20; **eur_sell_amt**: R$ 6,20; **eur_var_pct**: -2,00%; **created_at**: 2025-11-05 00:00:00; **updated_at**: 2025-11-05 00:00:00"
}
