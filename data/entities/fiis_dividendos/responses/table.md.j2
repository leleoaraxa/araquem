{% set rows = rows if rows is defined else [] %}

{% if rows and rows|length > 0 -%}
  {% set tickers = rows | map(attribute='ticker') | unique | list %}
  {% for ticker in tickers %}
    {% set subset = rows | selectattr('ticker', 'equalto', ticker) | list %}
    {% set latest = subset[0] %}
    **Dividendos de {{ ticker }}**

    Ãšltimo pagamento em {{ latest.payment_date|date_br if latest.payment_date is not none else '-' }}: **{{ latest.dividend_amt|currency_br if latest.dividend_amt is not none else '-' }}** por cota.

    | Data de pagamento | Data-com | Valor por cota |
    | --- | --- | --- |
    {% for r in subset %}
      | {{ r.payment_date|date_br if r.payment_date is not none else '-' }} | {{ r.traded_until_date|date_br if r.traded_until_date is not none else '-' }} | {{ r.dividend_amt|currency_br if r.dividend_amt is not none else '-' }} |
    {% endfor %}

  {%- endfor %}
{%- else -%}
  {{ empty_message or "Nenhum registro encontrado." }}
{%- endif %}
