# üìò DTM-011 ‚Äî Fronteira Eficiente de Markowitz (FIIs)

**Vers√£o:** 1.0
**Respons√°vel t√©cnico:** Leonardo J√∫nior (‚ÄúLeleo‚Äù)
**Data:** {{CURRENT_DATE}}
**√Årea:** Analytics / Indicadores / SiRiOS
**Status:** *Em valida√ß√£o interna*

---

## 1. Descri√ß√£o do Modelo

A **Fronteira Eficiente de Markowitz** implementada no SiRiOS tem como objetivo mensurar e visualizar o equil√≠brio risco-retorno de portf√≥lios compostos por Fundos Imobili√°rios (FIIs) listados na B3.

O modelo segue o paradigma **Mean‚ÄìVariance Optimization (MVO)**, formulado por Harry Markowitz (1952), e permite identificar as combina√ß√µes de ativos que maximizam o retorno esperado para um determinado n√≠vel de risco, sob restri√ß√£o de n√£o alavancagem (*no short selling*).

---

## 2. Fundamenta√ß√£o Te√≥rica

| Conceito             | Descri√ß√£o                                                                                  | Refer√™ncia           |
| -------------------- | ------------------------------------------------------------------------------------------ | -------------------- |
| Retorno esperado (Œº) | M√©dia aritm√©tica dos retornos di√°rios (logar√≠tmicos), anualizada por multiplica√ß√£o de 252. | Markowitz, 1952      |
| Risco (œÉ)            | Desvio-padr√£o dos retornos di√°rios, anualizado por ‚àö252.                                   | Markowitz, 1959      |
| Covari√¢ncia (Œ£)      | Matriz ( Œ£ = \mathrm{Cov}(R) \times 252 ) representando a intera√ß√£o entre ativos.          | Luenberger, 1998     |
| Otimiza√ß√£o           | Minimiza√ß√£o de ( w'Œ£w ) sujeita a ( w'Œº = Œº_p ), ( \sum w = 1 ), ( w ‚â• 0 ).                | Elton & Gruber, 1995 |
| √çndice de Sharpe     | ( S = \frac{Œº_p - r_f}{œÉ_p} ), medida de efici√™ncia ajustada ao risco.                     | Sharpe, 1964         |

---

## 3. Implementa√ß√£o T√©cnica

### 3.1 Fun√ß√µes SQL

1. **`public.get_fiis_returns()`**

   * Calcula retornos di√°rios por ticker, filtrando ativos com cobertura ‚â• `p_min_obs_ratio`.
   * Par√¢metros principais:

     | Nome              | Tipo    | Default | Descri√ß√£o                              |
     | ----------------- | ------- | ------- | -------------------------------------- |
     | `p_window_days`   | integer | 252     | Janela m√≥vel em preg√µes                |
     | `p_ret_kind`      | text    | `'log'` | Tipo de retorno (`'log'` | `'simple'`) |
     | `p_tickers`       | text[]  | NULL    | Lista opcional de tickers              |
     | `p_min_obs_ratio` | numeric | 0.80    | Cobertura m√≠nima de dados              |

2. **`public.get_fiis_stats()`**

   * Deriva estat√≠sticas por ativo (Œº, œÉ, Sharpe).
   * Inclui `p_rf_annual` (taxa livre de risco) e referencia `ref_date` m√°xima.

3. **`public.audit_markowitz_pairs()`**

   * Fun√ß√£o de auditoria que verifica se h√° ativos **acima da fronteira emp√≠rica** (anomalias estat√≠sticas).
   * Baseia-se em envelopes por pares de ativos.

---

## 4. Parametriza√ß√£o Oficial (Defaults SiRiOS)

| Par√¢metro         | Valor padr√£o | Intervalo aceito     | Observa√ß√µes                        |
| ----------------- | ------------ | -------------------- | ---------------------------------- |
| `p_window_days`   | 252          | 60‚Äì720               | Janela m√≥vel de 1 ano              |
| `p_ret_kind`      | `'log'`      | `'log'` | `'simple'` | Retornos logar√≠tmicos por padr√£o   |
| `p_rf_annual`     | 0.0          | 0.0‚Äì0.15             | Taxa livre de risco (Selic ‚âà 0.11) |
| `p_tickers`       | NULL         | 2‚Äì40 FIIs            | Universo analisado                 |
| `p_min_obs_ratio` | 0.80         | 0.60‚Äì1.00            | Cobertura m√≠nima                   |

---

## 5. Universo de Aplica√ß√£o

* Base de dados: `price_tickers` (pre√ßos ajustados, D-1)
* Universo padr√£o: FIIs listados com hist√≥rico ‚â• 252 dias e liquidez m√≠nima.
* Atualiza√ß√£o: di√°ria (refresh D-1).

---

## 6. Sa√≠das e Estrutura do Payload

Exemplo de resposta do endpoint `/analytics/fiis/frontier`:

```json
{
  "ref_date": "2025-11-07",
  "window_days": 252,
  "rf_annual": 0.0,
  "assets": [
    {"ticker": "HGLG11", "ret_annual": 0.0956, "vol_annual": 0.0991, "sharpe_annual": 0.964},
    {"ticker": "MXRF11", "ret_annual": 0.0999, "vol_annual": 0.0866, "sharpe_annual": 1.154}
  ],
  "frontier": [
    {"ret_annual": 0.0819, "vol_annual": 0.0742, "sharpe": 1.103, "weights": {"HGLG11": 0.11, "MXRF11": 0.89}}
  ],
  "min_variance": {"ret": 0.0721, "vol": 0.0602},
  "max_sharpe": {"ret": 0.0931, "vol": 0.0704, "sharpe": 1.32}
}
```

---

## 7. Auditoria e Monitoramento

| Indicador         | Origem                      | Interpreta√ß√£o                         |
| ----------------- | --------------------------- | ------------------------------------- |
| `anomalies_count` | `audit_markowitz_summary()` | n¬∫ de FIIs acima do envelope emp√≠rico |
| `pairs_count`     | combinat√≥ria de N ativos    | n¬∫ de pares usados na verifica√ß√£o     |
| `tickers_count`   | contagem de ativos v√°lidos  | universo usado                        |
| `ref_date`        | data de refer√™ncia D-1      | controle de janela                    |

* Alerta operacional: `anomalies_count > 0` ‚Üí revisar pipeline de pre√ßos.

---

## 8. Limita√ß√µes e Observa√ß√µes

* Modelo assume **normalidade dos retornos** e **estabilidade da covari√¢ncia**.
* N√£o considera **custos de transa√ß√£o**, **impostos** ou **restri√ß√µes regulat√≥rias**.
* Resultados s√£o **sens√≠veis √† janela temporal** e ao **universo de ativos**.

---

## 9. Refer√™ncias Bibliogr√°ficas

1. Markowitz, H. (1952). *Portfolio Selection*. Journal of Finance, 7(1), 77‚Äì91.
2. Markowitz, H. (1959). *Portfolio Selection: Efficient Diversification of Investments*. Wiley.
3. Sharpe, W. F. (1964). *Capital Asset Prices: A Theory of Market Equilibrium under Conditions of Risk*. Journal of Finance, 19(3), 425‚Äì442.
4. Elton, E. J., & Gruber, M. J. (1995). *Modern Portfolio Theory and Investment Analysis*. Wiley.
5. Luenberger, D. G. (1998). *Investment Science*. Oxford University Press.
6. Bodie, Z., Kane, A., & Marcus, A. J. (2014). *Investments* (10th ed.). McGraw-Hill.

---

## 10. Conclus√£o T√©cnica

A implementa√ß√£o SiRiOS da Fronteira Eficiente est√° **alinhada aos fundamentos cl√°ssicos da Teoria Moderna do Portf√≥lio**, com execu√ß√£o **compute-on-read**, fun√ß√µes **parametrizadas e audit√°veis**, e controle de consist√™ncia via **envelope emp√≠rico**.

Essa arquitetura permite rastreabilidade completa (dados ‚Üí fun√ß√£o ‚Üí endpoint ‚Üí visualiza√ß√£o) e sustenta√ß√£o te√≥rica perante **jur√≠dico, produto e auditoria interna**.

---
