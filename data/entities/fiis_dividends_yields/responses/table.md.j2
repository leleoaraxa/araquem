{% set rows = rows if rows is defined else [] %}

{% if not rows or rows|length == 0 -%}
{{ empty_message or "Nenhum registro encontrado." }}
{%- else -%}
{% set grouped = rows | groupby('ticker') %}
{%- for ticker, items in grouped %}
{%- set r = items[0] %}

**Dividendos e yield do{{ ' ' + r.ticker if r.ticker else '' }}**

- Mês de referência: **{{ r.ref_month if r.ref_month is not none else '-' }}**
- Data-com (cutoff): **{{ r.traded_until_date if r.traded_until_date is not none else '-' }}**
- Data de pagamento: **{{ r.payment_date if r.payment_date is not none else '-' }}**
- Dividendo por cota: **{{ r.dividend_amt if r.dividend_amt is not none else '-' }}**
- DY mensal: **{{ r.dy_current_monthly_pct if r.dy_current_monthly_pct is not none else '-' }}**
- DY 12 meses: **{{ r.dy_12m_pct if r.dy_12m_pct is not none else '-' }}**
- Dividendos acumulados 12m: **{{ r.dividends_12m_amt if r.dividends_12m_amt is not none else '-' }}**
- Último dividendo pago: **{{ r.last_dividend_amt if r.last_dividend_amt is not none else '-' }}** em **{{ r.last_payment_date if r.last_payment_date is not none else '-' }}**

{% set ultimos = items[:12] %}
| Mês de referência | Dividendo (R$) | DY mensal | DY 12m |
| --- | --- | --- | --- |
{%- for row in ultimos %}
| {{ row.ref_month if row.ref_month is not none else '-' }} | {{ row.dividend_amt if row.dividend_amt is not none else '-' }} | {{ row.dy_current_monthly_pct if row.dy_current_monthly_pct is not none else '-' }} | {{ row.dy_12m_pct if row.dy_12m_pct is not none else '-' }} |
{%- endfor %}

{%- if not loop.last %}

---

{%- endif %}
{%- endfor %}

{%- endif %}
