{
  "title": "00 · Sirios Overview",
  "uid": "sirios-overview",
  "timezone": "browser",
  "schemaVersion": 39,
  "version": 1,
  "style": "dark",
  "refresh": "30s",
  "time": {
    "from": "now-24h",
    "to": "now"
  },
  "panels": [
    {
      "id": 1,
      "type": "stat",
      "title": "Tráfego (req/s)",
      "gridPos": {"h": 4, "w": 4, "x": 0, "y": 0},
      "datasource": {"type": "{{ datasource }}", "uid": "{{ datasource_uid }}"},
      "targets": [
        {
          "expr": "sum(rate({{ bindings.api_requests_total }}{{ promql_filter(['job','entity','intent']) }}[5m]))",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "req/s",
          "thresholds": {"mode": "absolute","steps": [{"color": "green"}]}
        },
        "overrides": []
      },
      "options": {"reduceOptions": {"calcs": ["lastNotNull"],"fields": "","values": false},"orientation": "horizontal"}
    },
    {
      "id": 2,
      "type": "stat",
      "title": "Erros (%)",
      "gridPos": {"h": 4, "w": 4, "x": 4, "y": 0},
      "datasource": {"type": "{{ datasource }}", "uid": "{{ datasource_uid }}"},
      "targets": [
        {
          "expr": "100 * sum(rate({{ bindings.api_errors_total }}{{ promql_filter(['job','entity','intent']) }}[5m])) / sum(rate({{ bindings.api_requests_total }}{{ promql_filter(['job','entity','intent']) }}[5m]))",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "percentunit",
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {"color": "green"},
              {"color": "red", "value": {{ thresholds.api.error_rate_pct }}}
            ]
          }
        },
        "overrides": []
      },
      "options": {"reduceOptions": {"calcs": ["lastNotNull"],"fields": "","values": false},"orientation": "horizontal"}
    },
    {
      "id": 3,
      "type": "stat",
      "title": "Latência p95 (ms)",
      "gridPos": {"h": 4, "w": 4, "x": 8, "y": 0},
      "datasource": {"type": "{{ datasource }}", "uid": "{{ datasource_uid }}"},
      "targets": [
        {
          "expr": "histogram_quantile(0.95, sum(rate({{ bindings.api_latency_bucket }}{{ promql_filter(['job','entity','intent']) }}[5m])) by (le)) * 1000",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "ms",
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {"color": "green"},
              {"color": "red", "value": {{ thresholds.api.slo_ms_p95 }}}
            ]
          }
        },
        "overrides": []
      },
      "options": {"reduceOptions": {"calcs": ["lastNotNull"],"fields": "","values": false},"orientation": "horizontal"}
    },
    {
      "id": 4,
      "type": "stat",
      "title": "Cache hit ratio (%)",
      "gridPos": {"h": 4, "w": 4, "x": 12, "y": 0},
      "datasource": {"type": "{{ datasource }}", "uid": "{{ datasource_uid }}"},
      "targets": [
        {
          "expr": "100 * sum(rate({{ bindings.cache_hits_total }}{{ promql_filter(['entity']) }}[5m])) / (sum(rate({{ bindings.cache_hits_total }}{{ promql_filter(['entity']) }}[5m])) + sum(rate({{ bindings.cache_misses_total }}{{ promql_filter(['entity']) }}[5m])))",
          "refId": "A"
        }
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "percentunit",
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {"color": "red"},
              {"color": "green", "value": {{ thresholds.cache.min_hit_ratio_pct }}}
            ]
          }
        },
        "overrides": []
      },
      "options": {"reduceOptions": {"calcs": ["lastNotNull"],"fields": "","values": false},"orientation": "horizontal"}
    },
    {
      "id": 5,
      "type": "stat",
      "title": "RAG density",
      "gridPos": {"h": 4, "w": 4, "x": 16, "y": 0},
      "datasource": {"type": "{{ datasource }}", "uid": "{{ datasource_uid }}"},
      "targets": [{"expr": "avg({{ bindings.rag_index_density_score }}{{ promql_filter(['store']) }})","refId": "A"}],
      "fieldConfig": {
        "defaults": {
          "unit": "none",
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {"color": "red"},
              {"color": "green", "value": {{ thresholds.rag.min_density_docs_per_mb }}}
            ]
          }
        },
        "overrides": []
      },
      "options": {"reduceOptions": {"calcs": ["lastNotNull"],"fields": "","values": false},"orientation": "horizontal"}
    },
    {
      "id": 6,
      "type": "stat",
      "title": "Horas desde último refresh RAG",
      "gridPos": {"h": 4, "w": 4, "x": 20, "y": 0},
      "datasource": {"type": "{{ datasource }}", "uid": "{{ datasource_uid }}"},
      "targets": [{"expr": "(time() - max({{ bindings.rag_index_last_refresh_timestamp }}{{ promql_filter(['store']) }})) / 3600","refId": "A"}],
      "fieldConfig": {
        "defaults": {
          "unit": "h",
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {"color": "green"},
              {"color": "red", "value": {{ thresholds.rag.max_refresh_age_hours }}}
            ]
          }
        },
        "overrides": []
      },
      "options": {"reduceOptions": {"calcs": ["lastNotNull"],"fields": "","values": false},"orientation": "horizontal"}
    },
    {
      "id": 7,
      "type": "timeseries",
      "title": "Throughput por status",
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 4},
      "datasource": {"type": "{{ datasource }}", "uid": "{{ datasource_uid }}"},
      "targets": [
        {
          "expr": "sum(rate({{ bindings.api_requests_total }}{{ promql_filter(['job','entity','intent']) }}[5m])) by ({{ labels.status }})",
          "legendFormat": "{{ '{' * 2 }}{{ labels.status }}{{ '}' * 2 }}",
          "refId": "A"
        }
      ],
      "options": {"legend": {"showLegend": true},"tooltip": {"mode": "multi"}},
      "fieldConfig": {"defaults": {"unit": "req/s"},"overrides": []}
    },
    {
      "id": 8,
      "type": "timeseries",
      "title": "Latência p50/p95/p99",
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 4},
      "datasource": {"type": "{{ datasource }}", "uid": "{{ datasource_uid }}"},
      "targets": [
        {"expr": "histogram_quantile(0.50, sum(rate({{ bindings.api_latency_bucket }}{{ promql_filter(['job','entity','intent']) }}[5m])) by (le)) * 1000","refId": "A","legendFormat": "p50"},
        {"expr": "histogram_quantile(0.95, sum(rate({{ bindings.api_latency_bucket }}{{ promql_filter(['job','entity','intent']) }}[5m])) by (le)) * 1000","refId": "B","legendFormat": "p95"},
        {"expr": "histogram_quantile(0.99, sum(rate({{ bindings.api_latency_bucket }}{{ promql_filter(['job','entity','intent']) }}[5m])) by (le)) * 1000","refId": "C","legendFormat": "p99"}
      ],
      "fieldConfig": {
        "defaults": {
          "unit": "ms",
          "thresholds": {
            "mode": "absolute",
            "steps": [
              {"color": "green"},
              {"color": "red", "value": {{ thresholds.api.slo_ms_p95 }}}
            ]
          }
        },
        "overrides": []
      },
      "options": {"legend": {"showLegend": true},"tooltip": {"mode": "multi"}}
    },
    {
      "id": 9,
      "type": "table",
      "title": "Top entidades por tráfego",
      "gridPos": {"h": 8, "w": 12, "x": 0, "y": 12},
      "datasource": {"type": "{{ datasource }}", "uid": "{{ datasource_uid }}"},
      "targets": [
        {"expr": "topk(10, sum(rate({{ bindings.api_requests_total }}{{ promql_filter(['job','intent']) }}[15m])) by ({{ labels.entity }}))","format": "table","refId": "A"}
      ],
      "options": {"showHeader": true},
      "transformations": [{"id": "organize","options": {"excludeByName": {"Time": true}}}]
    },
    {
      "id": 10,
      "type": "table",
      "title": "Top intents por erro",
      "gridPos": {"h": 8, "w": 12, "x": 12, "y": 12},
      "datasource": {"type": "{{ datasource }}", "uid": "{{ datasource_uid }}"},
      "targets": [
        {"expr": "topk(10, sum(rate({{ bindings.api_errors_total }}{{ promql_filter(['job','entity']) }}[15m])) by ({{ labels.intent }}))","format": "table","refId": "A"}
      ],
      "options": {"showHeader": true},
      "transformations": [{"id": "organize","options": {"excludeByName": {"Time": true}}}]
    },
    {
      "id": 11,
      "type": "stat",
      "title": "RAG Recall@5",
      "gridPos": {"h": 4, "w": 4, "x": 0, "y": 20},
      "datasource": {"type": "{{ datasource }}", "uid": "{{ datasource_uid }}"},
      "targets": [{"expr": "rag_eval_recall_at_5","refId": "A"}],
      "description": "Binding: rag_eval_recall_at_5 | Threshold ref: {{ thresholds.rag_eval.min_recall_at_10_pct }}",
      "options": {"reduceOptions": {"calcs": ["last"],"fields": "","values": false}}
    },
    {
      "id": 12,
      "type": "stat",
      "title": "RAG Recall@10",
      "gridPos": {"h": 4, "w": 4, "x": 4, "y": 20},
      "datasource": {"type": "{{ datasource }}", "uid": "{{ datasource_uid }}"},
      "targets": [{"expr": "rag_eval_recall_at_10","refId": "A"}],
      "description": "Binding: rag_eval_recall_at_10 | Threshold ref: {{ thresholds.rag_eval.min_recall_at_10_pct }}",
      "options": {"reduceOptions": {"calcs": ["last"],"fields": "","values": false}}
    },
    {
      "id": 13,
      "type": "stat",
      "title": "RAG MRR",
      "gridPos": {"h": 4, "w": 4, "x": 8, "y": 20},
      "datasource": {"type": "{{ datasource }}", "uid": "{{ datasource_uid }}"},
      "targets": [{"expr": "rag_eval_mrr","refId": "A"}],
      "description": "Binding: rag_eval_mrr",
      "options": {"reduceOptions": {"calcs": ["last"],"fields": "","values": false}}
    },
    {
      "id": 14,
      "type": "stat",
      "title": "RAG nDCG@10",
      "gridPos": {"h": 4, "w": 4, "x": 12, "y": 20},
      "datasource": {"type": "{{ datasource }}", "uid": "{{ datasource_uid }}"},
      "targets": [{"expr": "rag_eval_ndcg_at_10","refId": "A"}],
      "description": "Binding: rag_eval_ndcg_at_10 | Threshold ref: {{ thresholds.rag_eval.min_ndcg_at_10 }}",
      "options": {"reduceOptions": {"calcs": ["last"],"fields": "","values": false}}
    },
    {
      "id": 15,
      "type": "stat",
      "title": "RAG Last Run (epoch)",
      "gridPos": {"h": 4, "w": 4, "x": 16, "y": 20},
      "datasource": {"type": "{{ datasource }}", "uid": "{{ datasource_uid }}"},
      "targets": [{"expr": "rag_eval_last_run_timestamp","refId": "A"}],
      "description": "Binding: rag_eval_last_run_timestamp",
      "options": {"reduceOptions": {"calcs": ["last"],"fields": "","values": false}}
    }
  ],
  "templating": {
    "list": [
      {
        "name": "job",
        "label": "Job",
        "type": "query",
        "datasource": {"type": "{{ datasource }}", "uid": "{{ datasource_uid }}"},
        "definition": "label_values({{ bindings.api_requests_total }}, {{ labels.job }})",
        "query": "label_values({{ bindings.api_requests_total }}, {{ labels.job }})",
        "refresh": 1,
        "includeAll": true,
        "multi": false,
        "current": {"selected": false,"text": "{{ variables.default_job }}","value": "{{ variables.default_job }}"}
      },
      {
        "name": "entity",
        "label": "Entity",
        "type": "query",
        "datasource": {"type": "{{ datasource }}", "uid": "{{ datasource_uid }}"},
        "definition": "label_values({{ bindings.api_requests_total }}, {{ labels.entity }})",
        "query": "label_values({{ bindings.api_requests_total }}, {{ labels.entity }})",
        "refresh": 1,
        "includeAll": true,
        "multi": false,
        "current": {"selected": false,"text": "{{ variables.default_entity }}","value": "{{ variables.default_entity }}"}
      },
      {
        "name": "intent",
        "label": "Intent",
        "type": "query",
        "datasource": {"type": "{{ datasource }}", "uid": "{{ datasource_uid }}"},
        "definition": "label_values({{ bindings.api_requests_total }}, {{ labels.intent }})",
        "query": "label_values({{ bindings.api_requests_total }}, {{ labels.intent }})",
        "refresh": 1,
        "includeAll": true,
        "multi": false,
        "current": {"selected": false,"text": "{{ variables.default_intent }}","value": "{{ variables.default_intent }}"}
      },
      {
        "name": "store",
        "label": "Store",
        "type": "query",
        "datasource": {"type": "{{ datasource }}", "uid": "{{ datasource_uid }}"},
        "definition": "label_values({{ bindings.rag_index_docs_total }}, {{ labels.store }})",
        "query": "label_values({{ bindings.rag_index_docs_total }}, {{ labels.store }})",
        "refresh": 1,
        "includeAll": true,
        "multi": false,
        "current": {"selected": false,"text": "{{ variables.default_store }}","value": "{{ variables.default_store }}"}
      },
      {
        "name": "interval",
        "type": "interval",
        "label": "Interval",
        "query": "5m,10m,15m,30m,1h"
      }
    ]
  },
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": {"type": "-- Grafana --", "uid": "grafana"},
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "name": "Annotations & Alerts",
        "type": "dashboard"
      }
    ]
  }
}
