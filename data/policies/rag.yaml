terms:
  - name: "rag"
    kind: "policy"
    scope: "rag"
    version: 2

version: 2

# ------------------------------------------------------------------------------
# 1) Perfis padrão para ranking híbrido (BM25 + semantic)
# ------------------------------------------------------------------------------
profiles:
  default:
    k: 6
    min_score: 0.20
    weight: { bm25: 0.70, semantic: 0.30 }
    tie_break: semantic
    max_context_chars: 12000

  macro:
    k: 4
    min_score: 0.10
    weight: { bm25: 0.50, semantic: 0.50 }
    tie_break: semantic

  risk:
    k: 6
    min_score: 0.15
    weight: { bm25: 0.60, semantic: 0.40 }

# ------------------------------------------------------------------------------
# 2) Roteamento por INTENT (super importante)
# Somente intents permitidas vão ativar RAG.
# ------------------------------------------------------------------------------
routing:
  deny_intents:
    - client_fiis_positions
    - fiis_cadastro
    - fiis_precos
    - fiis_dividendos
    - fiis_imoveis
    - fiis_rankings
    - fiis_processos
    - fiis_financials_snapshot
    - fiis_financials_revenue_schedule

  allow_intents:
    - fiis_noticias
    - fiis_financials_risk
    - history_market_indicators
    - history_b3_indexes
    - history_currency_rates

  notes: >
    RAG é ativado somente para domínios textuais: notícias de FIIs,
    risco quantitativo (explicações), macroeconomia, índices B3 e moedas.
    Dados numéricos continuam puramente SQL.

# ------------------------------------------------------------------------------
# 3) Política por entidade
# Evita misturar domínios e garante coerência semântica.
# ------------------------------------------------------------------------------
rag:
  entities:

    fiis_noticias:
      profile: default
      collections:
        - fiis_noticias
        - concepts-fiis
        - concepts-risk
      max_chunks: 6
      min_score: 0.20

    fiis_financials_risk:
      profile: risk
      collections:
        - concepts-risk
        - concepts-fiis
      max_chunks: 5
      min_score: 0.15
      notes: >
        Uso exclusivamente conceitual das métricas de risco; valores numéricos
        devem sempre vir de SQL, nunca do RAG.

    history_market_indicators:
      profile: macro
      collections:
        - concepts-macro
      max_chunks: 4
      min_score: 0.10

    history_b3_indexes:
      profile: macro
      collections:
        - concepts-macro
      max_chunks: 4
      min_score: 0.10

    history_currency_rates:
      profile: macro
      collections:
        - concepts-macro
      max_chunks: 4
      min_score: 0.10

  default:
    # fallback seguro
    profile: default
    max_chunks: 3
    collections:
      - concepts-fiis
    min_score: 0.25
