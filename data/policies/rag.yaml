terms:
- name: rag
  kind: policy
  scope: rag
  version: 2
version: 2
profiles:
  default:
    k: 6
    min_score: 0.2
    weight:
      bm25: 0.7
      semantic: 0.3
    tie_break: semantic
    max_context_chars: 12000
  macro:
    k: 4
    min_score: 0.1
    weight:
      bm25: 0.5
      semantic: 0.5
    tie_break: semantic
  risk:
    k: 6
    min_score: 0.15
    weight:
      bm25: 0.6
      semantic: 0.4
routing:
  deny_intents:
  - client_fiis_positions
  - client_fiis_dividends_evolution
  - client_fiis_performance_vs_benchmark
  - client_fiis_performance_vs_benchmark_summary
  - fiis_registrations
  - fiis_quota_prices
  - fiis_dividends
  - fiis_yield_history
  - fiis_real_estate
  - fiis_news
  - fiis_rankings
  - fiis_legal_proceedings
  - fiis_financials_snapshot
  - fiis_financials_revenue_schedule
  - fiis_financials_risk
  - fiis_overview
  - fiis_dividends_yields
  - client_fiis_enriched_portfolio
  - consolidated_macroeconomic
  allow_intents:
  - concepts_fiis
  - concepts_risk
  - concepts_macro
  notes: >
    RAG é ativado somente para domínios textuais do Bucket D.
    Buckets A, B e C permanecem puramente SQL; dados numéricos
    continuam sem RAG. No estado atual ainda não há intents
    específicas configuradas para o Bucket D, então o RAG
    permanece efetivamente desligado (rerank desabilitado) até
    criarmos intents ou entidades textuais elegíveis.
rerank:
  default:
    enabled: false
  intents: {}
  entities: {}
  domains: {}
rag:
  # TODO: Quando o runtime suportar filtros por tags, aplicar segmentação
  # por `domain:*` e exclusão global de `rag:deny` sem alterar o schema.
  entities:
    history_market_indicators:
      profile: macro
      collections:
      - concepts-macro
      max_chunks: 4
      min_score: 0.1
    history_b3_indexes:
      profile: macro
      collections:
      - concepts-macro
      max_chunks: 4
      min_score: 0.1
    history_currency_rates:
      profile: macro
      collections:
      - concepts-macro
      max_chunks: 4
      min_score: 0.1
    concepts:
      profile: default
      collections:
      - concepts-fiis
      - concepts-risk
      - concepts-macro
      max_chunks: 3
      min_score: 0.25
  default:
    profile: default
    max_chunks: 3
    collections:
    - concepts-fiis
    min_score: 0.25
concepts_shadow:
  enabled: false
  allow_intents: []
  deny_intents: []
  collections:
  - concepts-fiis
  - concepts-macro
  top_k_global: 40
  top_k: 4
  min_score: 0.25
  max_chars_per_snippet: 280
  max_matches: 2
  include_in_answer: false
