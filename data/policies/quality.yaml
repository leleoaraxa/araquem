version: 20251122
window: "rolling"

terms:
  - name: "quality"
    kind: "policy"
    scope: "quality"
    version: 1

# ATENÇÃO (V2 provisório):
# - Estes thresholds serão revisitados no marco M7 (RAG + Quality V3 + top2_gap fix).
# - Assim que o intent_top2_gap estiver maduro, a expectativa é voltar para algo como:
#     min_top1_accuracy: 0.95+
#     min_top2_gap: 0.20–0.25
#     max_misses_absolute / max_misses_ratio: mais apertados para produção
# - O bloco `targets` é a fonte canônica; mantemos `quality_gates.thresholds`
#   espelhado para compatibilidade com leituras antigas.
targets:
  min_top1_accuracy: 0.93     # temporário até o top2_gap fix / FIIs M7
  min_top2_gap: 0.00          # <<< desliga o gate de gap enquanto o fix não chega
  min_routed_rate: 0.98
  max_misses_absolute: 30     # tolerância provisória
  max_misses_ratio: 0.10

quality_gates:
  thresholds:  # compat: manter alinhado com `targets` enquanto transição V2
    min_top1_accuracy: 0.93
    min_top2_gap: 0.00
    min_routed_rate: 0.98
    max_misses_absolute: 30
    max_misses_ratio: 0.10

datasets:
  fiis_precos:
    freshness: { max_age_hours: 30 }
    not_null: [ticker, traded_at, close_price, adj_close_price]
    accepted_range:
      daily_variation_pct: { min: -5.0, max: 5.0 }

  fiis_dividendos:
    freshness: { max_age_hours: 30 }
    not_null: [ticker, payment_date, dividend_amt]
    accepted_range:
      dividend_amt: { min: 0.0 }

  fiis_yield_history:
    freshness: { max_age_hours: 30 }
    not_null: [ticker, ref_month, dividends_sum]
    accepted_range:
      dividends_sum: { min: 0.0, max: 700.0 }
      price_ref: { min: 0.01, max: 30000.0 }
      dy_monthly: { min: 0.0, max: 0.2 }

  fiis_imoveis:
    not_null: [ticker, asset_name]
    accepted_range:
      vacancy_ratio: { min: 0.0, max: 1.0 }
      non_compliant_ratio: { min: 0.0, max: 1.0 }

  fiis_processos:
    not_null: [ticker, process_number]
    accepted_range:
      loss_risk_pct: { min: 0.0, max: 1.0 }

  fiis_rankings:
    not_null: [ticker]
    accepted_range:
      users_rank_position: { min: 1 }
      sirios_rank_position: { min: 1 }
      ifix_rank_position: { min: 1 }
      ifil_rank_position: { min: 1 }

  fiis_financials_snapshot:
    freshness: { max_age_hours: 30 }
    not_null: [ticker]
    accepted_range:
      dividend_payout_pct: { min: 0.0 }
      leverage_ratio: { min: 0.0 }

  fiis_financials_revenue_schedule:
    freshness: { max_age_hours: 30 }
    not_null: [ticker]
    accepted_range:
      revenue_due_0_3m_pct: { min: 0.0, max: 1.0 }
      revenue_due_3_6m_pct: { min: 0.0, max: 1.0 }
      revenue_due_6_9m_pct: { min: 0.0, max: 1.0 }
      revenue_due_9_12m_pct: { min: 0.0, max: 1.0 }
      revenue_due_12_15m_pct: { min: 0.0, max: 1.0 }
      revenue_due_15_18m_pct: { min: 0.0, max: 1.0 }
      revenue_due_18_21m_pct: { min: 0.0, max: 1.0 }
      revenue_due_21_24m_pct: { min: 0.0, max: 1.0 }
      revenue_due_24_27m_pct: { min: 0.0, max: 1.0 }
      revenue_due_27_30m_pct: { min: 0.0, max: 1.0 }
      revenue_due_30_33m_pct: { min: 0.0, max: 1.0 }
      revenue_due_33_36m_pct: { min: 0.0, max: 1.0 }
      revenue_due_over_36m_pct: { min: 0.0, max: 1.0 }
      revenue_due_undetermined_pct: { min: 0.0, max: 1.0 }
      revenue_ipca_pct: { min: 0.0, max: 1.0 }
      revenue_igpm_pct: { min: 0.0, max: 1.0 }
      revenue_inpc_pct: { min: 0.0, max: 1.0 }
      revenue_incc_pct: { min: 0.0, max: 1.0 }

  fiis_financials_risk:
    freshness: { max_age_hours: 30 }
    not_null: [ticker]
    accepted_range:
      max_drawdown: { min: 0.0, max: 1.0 }
      r_squared: { min: 0.0, max: 1.0 }

  fiis_noticias:
    freshness: { max_age_hours: 30 }
    not_null: [ticker, title, url, published_at]

  fiis_cadastro:
    not_null: [ticker, fii_cnpj, display_name]

  client_fiis_positions:
    freshness: { max_age_minutes: 30 }
    not_null: [document_number, position_date, ticker]

  history_currency_rates:
    freshness: { max_age_hours: 30 }
    not_null: [rate_date]
    accepted_range:
      usd_buy_amt:  { min: 0.0 }
      usd_sell_amt: { min: 0.0 }
      eur_buy_amt:  { min: 0.0 }
      eur_sell_amt: { min: 0.0 }

  history_b3_indexes:
    freshness: { max_age_hours: 30 }
    not_null: [index_date]
    accepted_range:
      ibov_points_count: { min: 0.0 }
      ifix_points_count: { min: 0.0 }
      ifil_points_count: { min: 0.0 }
      ibov_var_pct:      { min: -5.0, max: 5.0 }
      ifix_var_pct:      { min: -5.0, max: 5.0 }
      ifil_var_pct:      { min: -5.0, max: 5.0 }

  history_market_indicators:
    freshness: { max_age_hours: 30 }
    not_null: [indicator_date, indicator_name]
    accepted_range:
      indicator_amt: { min: -5.0, max: 30.0 }
